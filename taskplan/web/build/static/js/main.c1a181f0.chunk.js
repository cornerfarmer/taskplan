(window.webpackJsonpweb=window.webpackJsonpweb||[]).push([[0],{103:function(e,t,a){e.exports=a(259)},257:function(e,t,a){},258:function(e,t,a){},259:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(97),r=a.n(i),o=a(2),c=a(3),l=a(5),u=a(4),h=a(1),d=a(6);a(108),a(109),a(111);Date.prototype.toShortStr=function(){function e(e){return(e=parseInt(e))<10?"0"+e:e}return this.getDate()+"."+(this.getMonth()+1)+" - "+e(this.getHours())+":"+e(this.getMinutes())};var p={INIT:0,QUEUED:1,RUNNING:2,STOPPED:3},m=a(50),f=a.n(m),v=a(98),k=a.n(v),g=a(99),b=a.n(g),E=a(100),y=a.n(E),C=a(51),j=a.n(C),O=(a(252),a(49)),N=a.n(O),w=(a(87),a(253)),S=a(91),_=S.prototype.updateDom;S.prototype.updateDom=function(e){var t=this;_.call(this,e);var a=this.dom.tdRevert;if(!a&&this.dom&&this.dom.tr&&this.fieldEditable&&("auto"===this.type||"array"===this.type||"string"===this.type)){a=document.createElement("td"),this.dom.tdRevert=a,this.dom.tdValue.parentNode.appendChild(a);var n=document.createElement("i");n.type="i",n.className="fas fa-undo-alt";var s=document.createElement("div");s.type="div",s.className="revert",s.onclick=function(){t.editor.options.onRevert({path:t.getPath(),field:t.field,value:t.value})},s.appendChild(n),a.appendChild(s)}},j.a.VALID_OPTIONS.push("onRevert"),console.log(S);var T=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t={onModeChange:function(t){e.updateEditor(),"tree"===t&&e.jsoneditor.expandAll()},onClassName:function(t){return e.pathExistsInJson(t.path,e.props.inheritedJson)&&!e.pathExistsInJson(t.path,e.props.json)?"inherited-value":!e.pathExistsInJson(t.path,e.props.inheritedJson)&&e.pathExistsInJson(t.path,e.props.json)?"new-value":void 0},onEditable:function(t){return e.pathExistsInJson(t.path,e.props.inheritedJson)?{field:!1,value:!0}:{field:!0,value:!0}},onChange:function(){if("code"===e.jsoneditor.getMode())try{var t=e.jsoneditor.get();e.props.json!==t&&e.props.onChange(t)}catch(a){e.err=a}},onChangeJSON:function(t){if("tree"===e.jsoneditor.getMode()){var a={};e.updateFromJsonEditor(a,e.props.json,e.props.inheritedJson,t,[]),e.props.onChange(a),console.log(a)}},onRevert:function(t){for(var a=f()(e.props.json),n=a,s=[a],i=0;i<t.path.length;i++)i===t.path.length-1?delete n[t.path[i]]:(n=n[t.path[i]],s.push(n));for(i=t.path.length-2;i>=0&&b()(s[i][t.path[i]]);i--)delete s[i][t.path[i]];e.props.onChange(a),e.updateEditor()}};t.mode="mode"in this.props.options?this.props.options.mode:"tree",t.modes="modes"in this.props.options?this.props.options.modes:["code","tree"],t.ace=N.a,t.history=!1,t.enableSort=!1,t.enableTransform=!1,t.mainMenuBar=!("mainMenuBar"in this.props.options)||this.props.options.mainMenuBar,t.statusBar=!("statusBar"in this.props.options)||this.props.options.statusBar,this.jsoneditor=new j.a(this.container,t),"readOnly"in this.props.options&&this.props.options.readOnly&&this.jsoneditor.aceEditor.setReadOnly(!0),"json"in this.props&&(this.updateEditor(),"tree"===t.mode&&this.jsoneditor.expandAll())}},{key:"updateFromJsonEditor",value:function(e,t,a,n,s){for(var i in n)"object"===typeof n[i]&&!Array.isArray(n[i])&&Object.keys(n[i]).length>0?this.updateFromJsonEditor(e,i in t?t[i]:{},i in a?a[i]:{},n[i],s.concat([i])):(i in a&&!y()(a[i],n[i])||!(i in a)||i in t)&&this.setValueAtPath(e,s.concat([i]),n[i])}},{key:"pathExistsInJson",value:function(e,t){if(!e)return!1;for(var a=t,n=0;n<e.length;n++){if(n===e.length-1)return e[n]in a;if(!(e[n]in a))return!1;a=a[e[n]]}return!1}},{key:"setValueAtPath",value:function(e,t,a){for(var n=e,s=0;s<t.length;s++)s===t.length-1?n[t[s]]=a:(t[s]in n||(n[t[s]]={}),n=n[t[s]])}},{key:"componentDidUpdate",value:function(){}},{key:"updateEditor",value:function(){if("code"===this.jsoneditor.getMode())this.jsoneditor.setText(w(this.props.json,{space:"  "}));else{var e=f()(this.props.inheritedJson);k()(e,this.props.json),this.jsoneditor.setText(w(e,{space:"  "}))}}},{key:"componentWillUnmount",value:function(){this.jsoneditor&&this.jsoneditor.destroy()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"jsoneditor-react-container"+("readOnly"in this.props.options&&this.props.options.readOnly?" jsoneditor-readOnly":""),ref:function(t){return e.container=t}})}}]),t}(s.a.Component),D=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={config:{},inheritedConfig:{},loadedUrl:null,dataJsonString:""},a.jsonEditor=s.a.createRef(),a.onChange=a.onChange.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e,t){e.url===this.props.url&&JSON.stringify(e.bases)===JSON.stringify(this.props.bases)||this.reload()}},{key:"componentDidMount",value:function(){this.setState({loadedUrl:null}),this.reload()}},{key:"reload",value:function(){var e=this;if(""===this.props.url)this.state.loadedUrl!==this.props.url&&(this.setState({config:{},inheritedConfig:{},loadedUrl:this.props.url}),null!==this.jsonEditor.current&&this.jsonEditor.current.updateEditor());else{var t={};t.bases=this.props.bases;var a=JSON.stringify(t);if(this.state.loadedUrl!==this.props.url||this.state.dataJsonString!==a){var n=new FormData;n.append("data",a),fetch(this.props.url,{method:"POST",body:n}).then(function(e){return e.json()}).then(function(t){e.setState({inheritedConfig:t.inherited_config,config:null!==t.config?t.config:e.state.config,loadedUrl:e.props.url,dataJsonString:a}),e.jsonEditor.current.updateEditor(),void 0!==e.props.onDynamicChange&&e.props.onDynamicChange(t.dynamic)},function(e){})}}}},{key:"onChange",value:function(e){this.setState({config:e})}},{key:"render",value:function(){return this.state.loadedUrl===this.props.url?s.a.createElement(T,{ref:this.jsonEditor,json:this.state.config,inheritedJson:this.state.inheritedConfig,onChange:this.onChange,options:this.props.preview?{mode:"code",modes:["code"],readOnly:!0,mainMenuBar:!1,statusBar:!1}:{}}):s.a.createElement("div",{className:"editor-loading"},s.a.createElement("i",{className:"fas fa-sync fa-spin fa-2x"}))}}]),t}(s.a.Component),R=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={dialogOpen:!1,inputValue:a.props.defaultValue,device:null},a.configEditor=s.a.createRef(),a.start=a.start.bind(Object(h.a)(a)),a.openDialog=a.openDialog.bind(Object(h.a)(a)),a.closeDialog=a.closeDialog.bind(Object(h.a)(a)),a.updateInputValue=a.updateInputValue.bind(Object(h.a)(a)),a.onKeyDown=a.onKeyDown.bind(Object(h.a)(a)),a.onChange=a.onChange.bind(Object(h.a)(a)),a.onDeviceChange=a.onDeviceChange.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"start",value:function(){if(this.setState({dialogOpen:!1}),this.props.presetEditor){var e=new FormData;e.append("data",JSON.stringify(this.configEditor.current.state.config)),fetch(this.props.url,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){})}else fetch(this.props.url+(this.props.devices?"/"+this.state.device:"")+"/"+this.state.inputValue).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"onDeviceChange",value:function(e){this.setState({device:e.target.value})}},{key:"openDialog",value:function(){this.setState({dialogOpen:!0,device:this.props.devices?this.props.devices[0].uuid:null})}},{key:"closeDialog",value:function(){this.setState({dialogOpen:!1})}},{key:"updateInputValue",value:function(e){this.setState({inputValue:e.target.value})}},{key:"onKeyDown",value:function(e){13===e.keyCode&&(e.preventDefault(),this.start()),27===e.keyCode&&(e.preventDefault(),this.closeDialog())}},{key:"onChange",value:function(e){this.setState({inputValue:e})}},{key:"render",value:function(){var e=this;return this.state.dialogOpen?s.a.createElement("div",{className:"prompt-wrapper"},s.a.createElement("div",{className:this.props.presetEditor?"prompt preset-prompt":"prompt"},s.a.createElement("div",{className:"prompt-header"},this.props.header),s.a.createElement("div",{className:"prompt-text"},this.props.text),!this.props.presetEditor&&s.a.createElement("input",{autoFocus:!0,onFocus:function(e){e.target.select()},type:"text",name:"iterations",value:this.state.inputValue,onChange:function(t){return e.updateInputValue(t)},onKeyDown:this.onKeyDown}),this.props.presetEditor&&s.a.createElement(D,{ref:this.configEditor,url:this.props.presetEditorUrl}),this.props.devices&&s.a.createElement("select",{value:this.state.device,onChange:this.onDeviceChange},this.props.devices.map(function(e){return s.a.createElement("option",{value:e.uuid},e.name)})),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.start},"Ok"),s.a.createElement("div",{onClick:this.closeDialog},"Cancel")))):""}}]),t}(s.a.Component),P=a(12),x=a.n(P),V=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).wrapperRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){x()(this.wrapperRef.current).find('[data-toggle="tooltip"]').tooltip()}},{key:"componentDidUpdate",value:function(){x()(this.wrapperRef.current).find('[data-toggle="tooltip"]').tooltip()}},{key:"render",value:function(){return this.props.task.is_test?s.a.createElement("span",{ref:this.wrapperRef},"Test"):this.props.task.nameChoices.length>0?s.a.createElement("span",{ref:this.wrapperRef},this.props.task.nameChoices.map(function(e,t){for(var a=e[1].name,n=2;n<e.length;n++)a=a.replace("$T"+(n-2)+"$",e[n]);return s.a.createElement("span",{key:t},0!==t&&s.a.createElement("span",{className:"separator"},"/"),s.a.createElement("span",{"data-toggle":"tooltip","data-placement":"bottom","data-original-title":e[0].name+": "+a},a))})):s.a.createElement("span",{ref:this.wrapperRef},"Default config")}}]),t}(s.a.Component);function I(e){if(e.state===p.RUNNING){var t=function(e){return(e=parseInt(e))<10?"0"+e:e},a=function(e){return e>0?e>=3600?t(e/3600)+":"+t(e%3600/60)+":"+t(e%60):t(e/60)+":"+t(e%60):"--:--"};return s.a.createElement("div",{className:"time"},a(e.run_time)," / ",a(e.total_time))}return s.a.createElement("div",{className:"time"},e.index+1)}function M(e){if(e.state===p.RUNNING){var t={width:(e.mean_iteration_time>0?100*Math.min(1,((e.run_time+e.start_time-e.iteration_update_time)/e.mean_iteration_time+e.finished_iterations)/e.total_iterations):0)+"%"};return s.a.createElement("div",{className:"progress",style:t})}return""}var A=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).pause=a.pause.bind(Object(h.a)(a)),a.saveNow=a.saveNow.bind(Object(h.a)(a)),a.cancel=a.cancel.bind(Object(h.a)(a)),a.runNow=a.runNow.bind(Object(h.a)(a)),a.openExtraDialog=a.openExtraDialog.bind(Object(h.a)(a)),a.openPresetDialog=a.openPresetDialog.bind(Object(h.a)(a)),a.promptExtraRefs=s.a.createRef(),a.promptPresetRefs=s.a.createRef(),a.openLog=a.openLog.bind(Object(h.a)(a)),a.clone=a.clone.bind(Object(h.a)(a)),a.terminate=a.terminate.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"pause",value:function(){fetch("/pause/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"saveNow",value:function(){fetch("/save_now/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"cancel",value:function(){fetch("/cancel/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"runNow",value:function(){fetch("/run_now/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"openExtraDialog",value:function(){this.promptExtraRefs.current.openDialog()}},{key:"openPresetDialog",value:function(){this.promptPresetRefs.current.openDialog()}},{key:"openLog",value:function(){window.open("/log/"+this.props.task.uuid,"_blank")}},{key:"clone",value:function(){fetch("/clone_task/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"terminate",value:function(){fetch("/terminate/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"render",value:function(){var e="";return this.props.task.is_pausing?e="pausing...":this.props.task.is_saving&&(e="saving..."),s.a.createElement("div",{className:"toolbar"},this.props.task.state===p.RUNNING&&s.a.createElement("span",null,s.a.createElement("div",{className:"action",onClick:this.pause,title:"Pause the task after the current iteration"},s.a.createElement("i",{className:"fa fa-pause"}),s.a.createElement("span",null,"Pause")),s.a.createElement("div",{className:"action",onClick:this.saveNow,title:"Force the task to save after the current iteration"},s.a.createElement("i",{className:"fas fa-save"}),s.a.createElement("span",null,"Save now!")),s.a.createElement("div",{className:"action",onClick:this.openExtraDialog,title:"Change the scheduled number of total iterations"},s.a.createElement("i",{className:"fa fa-edit"}),s.a.createElement("span",null,"Change")),s.a.createElement("div",{className:"dropdown"},s.a.createElement("div",{className:"action dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-ellipsis-v"})),s.a.createElement("div",{className:"dropdown-menu"},s.a.createElement("div",{className:"action",onClick:this.openLog,title:"View the log"},s.a.createElement("i",{className:"far fa-file-alt"}),s.a.createElement("span",null,"Log")),s.a.createElement("div",{className:"action",onClick:this.openPresetDialog,title:"Adjust the configuration on the fly"},s.a.createElement("i",{className:"fas fa-code"}),s.a.createElement("span",null,"Config")),s.a.createElement("div",{className:"action",onClick:this.clone,title:"Clone task"},s.a.createElement("i",{className:"far fa-copy"}),s.a.createElement("span",null,"Clone")),s.a.createElement("div",{className:"action",onClick:this.terminate,title:"Terminate task"},s.a.createElement("i",{className:"fas fa-skull-crossbones"}),s.a.createElement("span",null,"Terminate")))),s.a.createElement("div",{className:"current-action"},e)),this.props.task.state===p.QUEUED&&s.a.createElement("span",null,s.a.createElement("div",{className:"action",onClick:this.runNow,title:"Pause one of the running tasks and start this one instead"},s.a.createElement("i",{className:"fas fa-exclamation-triangle"}),s.a.createElement("span",null,"Run now!")),s.a.createElement("div",{className:"action",onClick:this.openExtraDialog,title:"Change the scheduled number of total iterations"},s.a.createElement("i",{className:"fa fa-edit"}),s.a.createElement("span",null,"Change")),s.a.createElement("div",{className:"action",onClick:this.openPresetDialog,title:"Adjust the configuration on the fly"},s.a.createElement("i",{className:"fas fa-code"}),s.a.createElement("span",null,"Config")),s.a.createElement("div",{className:"dropdown"},s.a.createElement("div",{className:"action dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-ellipsis-v"})),s.a.createElement("div",{className:"dropdown-menu"},s.a.createElement("div",{className:"action",onClick:this.cancel,title:"Remove this task from the queue"},s.a.createElement("i",{className:"fas fa-times"}),s.a.createElement("span",null,"Cancel")),s.a.createElement("div",{className:"action",onClick:this.clone,title:"Clone task"},s.a.createElement("i",{className:"far fa-copy"}),s.a.createElement("span",null,"Clone"))))),s.a.createElement(R,{ref:this.promptExtraRefs,defaultValue:this.props.task.total_iterations,header:"Change total iterations?",text:"Specify the new number of iterations, you want the task to run:",url:"/change/"+this.props.task.uuid}),s.a.createElement(R,{ref:this.promptPresetRefs,presetEditor:!0,presetEditorUrl:"/config/task_timestep/"+this.props.task.uuid,header:"Change config?",text:"Specify the new configuration which will be used on the fly:",url:"/adjust_task_preset/"+this.props.task.uuid}))}}]),t}(s.a.Component),U=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).projectName=s.a.createRef(),a.onMouseDown=a.onMouseDown.bind(Object(h.a)(a)),a.onDragStart=a.onDragStart.bind(Object(h.a)(a)),a.onDragOver=a.onDragOver.bind(Object(h.a)(a)),a.onDragEnter=a.onDragEnter.bind(Object(h.a)(a)),a.onDragLeave=a.onDragLeave.bind(Object(h.a)(a)),a.onDrop=a.onDrop.bind(Object(h.a)(a)),a.taskRef=s.a.createRef(),a.dragEnterCounter=0,a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"onMouseDown",value:function(e){this.target=e.target}},{key:"onDragStart",value:function(e){this.projectName.current.contains(this.target)?e.dataTransfer.setData("text/plain",this.props.task.uuid):e.preventDefault()}},{key:"onDragOver",value:function(e){this.props.task.state===p.QUEUED&&this.props.task.uuid!==e.dataTransfer.getData("text/plain")&&e.preventDefault()}},{key:"onDrop",value:function(e){this.props.task.state===p.QUEUED&&this.props.task.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),fetch("/reorder_task/"+e.dataTransfer.getData("text/plain")+"/"+this.props.index).then(function(e){return e.json()}).then(function(e){},function(e){}),this.dragEnterCounter=0,this.taskRef.current.className="task")}},{key:"onDragEnter",value:function(e){this.props.task.state===p.QUEUED&&this.props.task.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),this.taskRef.current.className="task on-drag-over",this.dragEnterCounter++)}},{key:"onDragLeave",value:function(e){this.props.task.state===p.QUEUED&&this.props.task.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),this.dragEnterCounter--,0===this.dragEnterCounter&&(this.taskRef.current.className="task"))}},{key:"render",value:function(){var e=this;return s.a.createElement("li",{ref:this.taskRef,className:"task",onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter,onDrop:this.onDrop,onDragStart:this.onDragStart,onMouseDown:this.onMouseDown,draggable:this.props.task.state===p.QUEUED?"true":"false"},s.a.createElement("div",{className:"content"},s.a.createElement("div",{className:"header"},s.a.createElement("div",{className:"project-name",ref:this.projectName},this.props.task.project_name),s.a.createElement("div",{className:"status"},s.a.createElement(I,{index:this.props.index,state:this.props.task.state,total_time:this.props.task.total_time,run_time:this.props.task.run_time}),s.a.createElement("div",{className:"iterations"},this.props.task.finished_iterations," / ",this.props.task.total_iterations))),s.a.createElement(M,{state:this.props.task.state,total_iterations:this.props.task.total_iterations,run_time:this.props.task.run_time,start_time:this.props.task.start_time_timestamp,mean_iteration_time:this.props.task.mean_iteration_time,finished_iterations:this.props.task.finished_iterations,iteration_update_time:this.props.task.iteration_update_time}),s.a.createElement("div",{className:"preset-name",onClick:function(){return e.props.highlightTask(e.props.task)}},s.a.createElement("span",{className:"try-number"},this.props.task.try),s.a.createElement(V,{task:this.props.task}))),s.a.createElement(A,{task:this.props.task}))}}]),t}(s.a.Component),B=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={tasks:[],max_running:1},a.props.evtSource.addEventListener("SCHEDULER_OPTIONS",function(e){var t=JSON.parse(e.data);a.setState({max_running:t.max_running})}),a.openMaxRunningDialogRefs=s.a.createRef(),a.updateTasks=a.updateTasks.bind(Object(h.a)(a)),a.openMaxRunningDialog=a.openMaxRunningDialog.bind(Object(h.a)(a)),a.connectDevice=a.connectDevice.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.timerID=setInterval(function(){var a=e.state.tasks.slice();a.filter(function(e){return e.state===p.RUNNING}).forEach(function(e){return t.refreshRunTime(e)}),e.setState({tasks:a})},1e3),this.props.repository.onChange("tasks",this.updateTasks),this.updateTasks(this.props.repository.tasks)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID),this.props.repository.removeOnChange("tasks",this.updateTasks)}},{key:"updateTasks",value:function(e){this.setState({tasks:Object.values(e).filter(function(e){return e.state===p.RUNNING||e.state===p.QUEUED})})}},{key:"openMaxRunningDialog",value:function(){this.openMaxRunningDialogRefs.current.openDialog()}},{key:"connectDevice",value:function(e){fetch("/connect_device/"+e.uuid).then(function(e){return e.json()}).then(function(e){})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"scheduler"},this.props.devices.map(function(t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("h2",null,t.name,t.is_connected>=0&&" - "+(1===t.is_connected?"Connected":"Not connected")),s.a.createElement("h3",null,"Running (",e.state.tasks.filter(function(e){return e.state===p.RUNNING&&e.device===t.uuid}).length," / ",s.a.createElement("span",{id:"max-running-tasks",title:"Adjust the maximum number of parallel running tasks",onClick:e.openMaxRunningDialog},e.state.max_running),")"),s.a.createElement(R,{ref:e.openMaxRunningDialogRefs,defaultValue:e.state.max_running,header:"Set maximum parallel tasks?",text:"Specify the new number of tasks which can run in parallel:",url:"/change_max_running"}),0===t.is_connected&&s.a.createElement("div",{onClick:function(){return e.connectDevice(t)}},"Connect"),s.a.createElement("ul",{className:"tasks",id:"tasks-running"},e.state.tasks.filter(function(e){return e.state===p.RUNNING&&e.device===t.uuid}).map(function(t,a){return s.a.createElement(U,{key:t.uuid,task:t,index:a,highlightTask:e.props.highlightTask})})),s.a.createElement("h3",null,"Waiting (",e.state.tasks.filter(function(e){return e.state===p.QUEUED&&e.device===t.uuid}).length,")"),s.a.createElement("ul",{className:"tasks",id:"tasks-queued"},e.state.tasks.filter(function(e){return e.state===p.QUEUED&&e.device===t.uuid}).sort(function(e,t){return e.queue_index-t.queue_index}).map(function(t,a){return s.a.createElement(U,{key:t.uuid,task:t,index:a,highlightTask:e.props.highlightTask})})))}))}}],[{key:"refreshRunTime",value:function(e){e.run_time=parseInt((Date.now()-e.start_time)/1e3)}}]),t}(s.a.Component),L=a(13),F=function(){function e(){Object(o.a)(this,e),this.children={},this.parent=null,this.parentKey=""}return Object(c.a)(e,[{key:"setChild",value:function(e,t){this.children[e]=t,t.parent=this,t.parentKey=e}},{key:"insertAsParent",value:function(e,t){this.parent.setChild(this.parentKey,t),t.setChild(e,this)}},{key:"remove",value:function(){var e=Object.keys(this.children)[0],t=this.children[e];return this.parent.children[this.parentKey]=t,t.parent=this.parent,t.parentKey=this.parentKey,e}},{key:"removeSubtree",value:function(){delete this.parent.children[this.parentKey]}},{key:"getFirstTaskIn",value:function(){return Object.keys(this.children).length>0?this.children[Object.keys(this.children)[0]].getFirstTaskIn():null}},{key:"getAllContainedTasks",value:function(){for(var e=[],t=0,a=Object.values(this.children);t<a.length;t++){var n=a[t];e=e.concat(n.getAllContainedTasks())}return e}}]),e}(),J=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),t}(F),G=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this))).preset=e,a}return Object(d.a)(t,e),t}(F),H=function(e){function t(e){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this))}return Object(d.a)(t,e),t}(F),K=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getFirstTaskIn",value:function(){return Object.keys(this.children).length>0?this.children[0]:null}},{key:"getAllContainedTasks",value:function(){return Object.values(this.children)}}]),t}(F),q=function(){function e(t){Object(o.a)(this,e),this.root=new J,this.root.setChild("default",new K),this.taskByUuid={},this.tasks={},this.presets=[],this.presetsByUuid={},this.includeCodeVersion=t}return Object(c.a)(e,[{key:"presetCompare",value:function(e,t){return e.sorting!==t.sorting?e.sorting-t.sorting:e.uuid.localeCompare(t.uuid)}},{key:"updatePresets",value:function(e){var t=this,a=!0,n=!1,s=void 0;try{for(var i,r=e[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;this.presetsByUuid[o.uuid]=o}}catch(p){n=!0,s=p}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}for(var c=e.slice().sort(function(e,a){return t.presetCompare(e,a)}),l=function(e){-1===c.findIndex(function(a){return a.uuid===t.presets[e].uuid})&&(t.removePreset(t.presets[e]),e--),u=e},u=0;u<this.presets.length;u++)l(u);for(var h=function(e){if(e>=t.presets.length)return t.addPreset(c[e],e),"continue";if(t.presets[e].uuid!==c[e].uuid){if(-1!==t.presets.findIndex(function(t){return t.uuid===c[e].uuid})){var a=t.presets.find(function(t){return t.uuid===c[e].uuid});t.removePreset(a)}if(t.addPreset(c[e],e),t.presets[e].uuid!==c[e].uuid)throw new Error("Error with the presets in the view")}else t.presets[e]=c[e]},d=0;d<c.length;d++)h(d)}},{key:"addPreset",value:function(e,t){this.presets.splice(t,0,e),this.addNodeWithPreset(e,this.root.children.default)}},{key:"addNodeWithPreset",value:function(e,t){if(t instanceof G&&this.presetCompare(this.presetsByUuid[t.preset],e)>0||t instanceof K){var a=t.getFirstTaskIn();if(null!==a){var n=this.getChoiceKeyToPreset(this.tasks[a],e),s=t.getAllContainedTasks(),i=[],r=!0,o=!1,c=void 0;try{for(var l,u=s[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var h=l.value;this.getChoiceKeyToPreset(this.tasks[h],e)!==n&&i.push(h)}}catch(k){o=!0,c=k}finally{try{r||null==u.return||u.return()}finally{if(o)throw c}}if(i.length>0){var d=new G(e.uuid);this.addPresetBeforeNode(t,d,n);for(var p=0,m=i;p<m.length;p++){var f=m[p];this.removeTask(this.tasks[f]),this.addTask(this.tasks[f])}}}}else for(var v in t.children)this.addNodeWithPreset(e,t.children[v])}},{key:"removePreset",value:function(e){this.presets.includes(e)&&(this.presets.splice(this.presets.indexOf(e),1),this.removeNodesWithPreset(e,this.root.children.default))}},{key:"removeNodesWithPreset",value:function(e,t){if(t instanceof G&&t.preset===e.uuid){var a=[],n=!0,s=!1,i=void 0;try{for(var r,o=Object.keys(t.children).slice(1)[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value;a=a.concat(this.removeSubtree(t.children[c]))}}catch(v){s=!0,i=v}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}t.remove();var l=!0,u=!1,h=void 0;try{for(var d,p=a[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var m=d.value;this.addTask(this.tasks[m])}}catch(v){u=!0,h=v}finally{try{l||null==p.return||p.return()}finally{if(u)throw h}}}else if(!(t instanceof K))for(var f in t.children)this.removeNodesWithPreset(e,t.children[f])}},{key:"removeSubtree",value:function(e){var t=e.getAllContainedTasks(),a=!0,n=!1,s=void 0;try{for(var i,r=t[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;delete this.taskByUuid[o.uuid]}}catch(c){n=!0,s=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}return e.removeSubtree(),t}},{key:"updateTasks",value:function(e){this.tasks=e}},{key:"updateTask",value:function(e){this.tasks[e.uuid]=e}},{key:"addTasks",value:function(e){var t=!0,a=!1,n=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var r=s.value;this.addTask(r)}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}}},{key:"addTask",value:function(e){this.tasks[e.uuid]=e;var t=this.root.children.default,a=[];this.includeCodeVersion&&a.push("code_version"),a=a.concat(this.presets);var n=!0,s=!1,i=void 0;try{for(var r,o=a[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,l=void 0,u=void 0;if("object"===typeof c){if(""===c.deprecated_choice)continue;l=this.getChoiceKeyToPreset(e,c),u=t instanceof G&&t.preset===c.uuid}else{if("code_version"!==c)throw new Error("Invalid branching option");l=e.version,u=t instanceof H}if(!u){var h=t.getFirstTaskIn();if(null===h)continue;var d=void 0,p=void 0;if("object"===typeof c){if((p=this.getChoiceKeyToPreset(this.tasks[h],c))===l)continue;d=new G(c.uuid)}else{if("code_version"!==c)throw"";if(this.tasks[h].version===l)continue;d=new H,p=this.tasks[h].version}t=this.addPresetBeforeNode(t,d,p)}l in t.children||t.setChild(l,new K),t=t.children[l]}}catch(m){s=!0,i=m}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}this.insertTask(t,e)}},{key:"removeTask",value:function(e){var t=this.taskByUuid[e.uuid],a=parseInt(this.keyInDict(t.children,e.uuid));delete t.children[a];for(var n=a;n+1 in t.children;)t.children[n]=t.children[n+1],delete t.children[n+1],n++;delete this.taskByUuid[e.uuid]}},{key:"keyInDict",value:function(e,t){return Object.keys(e).find(function(a){return e[a]===t})}},{key:"checkNodeForRemoval",value:function(e){0!==Object.keys(e.children).length||e.parent instanceof J?1===Object.keys(e.children).length&&e.parent instanceof G&&e.remove():(delete e.parent.children[e.parentKey],this.checkNodeForRemoval(e.parent))}},{key:"addPresetBeforeNode",value:function(e,t,a){return e.insertAsParent(a,t),t}},{key:"getChoiceToPreset",value:function(e,t){var a=null,n=[],s=!0,i=!1,r=void 0;try{for(var o,c=e.choices[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var l=o.value;if(l[0].preset===t.uuid){a=l[0],n=l.slice(1);break}}}catch(u){i=!0,r=u}finally{try{s||null==c.return||c.return()}finally{if(i)throw r}}return null===a?[t.deprecated_choice,n]:[a,n]}},{key:"getChoiceKeyToPreset",value:function(e,t){var a=this.getChoiceToPreset(e,t);return this.getKeyToChoice(a)}},{key:"getKeyToChoice",value:function(e){for(var t=e[0].name,a=0;a<e[1].length;a++)t=t.replace("$T"+a+"$",e[1][a]);return t}},{key:"compTasks",value:function(e,t){return this.tasks[e].creation_time<this.tasks[t].creation_time}},{key:"insertTask",value:function(e,t){this.taskByUuid[t.uuid]=e;for(var a=Object.keys(e.children),n=a.length,s=0;s<a.length;s++)if(!this.compTasks(e.children[s],t.uuid)){n=s;break}for(var i=a.length-1;i>=n;i--)e.children[i+1]=e.children[i];e.children[n]=t.uuid}},{key:"getNodeChoicePath",value:function(e,t){for(var a=[];!(e instanceof J)&&!(e.parent instanceof J)&&!(e instanceof H)&&!(e.parent instanceof H);)a.unshift([this.presetsByUuid[e.parent.preset]].concat(Object(L.a)(this.getChoiceToPreset(t,this.presetsByUuid[e.parent.preset])))),e=e.parent;return a}},{key:"getSelectedTask",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.root.children.default;if(n instanceof H){if(!(a in n.children))return[];n=n.children[a]}var s=!0,i=!1,r=void 0;try{for(var o,c=function(){var a=o.value;if(""!==a.deprecated_choice){var s=a.choices.find(function(t){return t.uuid===e[a.uuid][0]}),i=t.getKeyToChoice([s,e[a.uuid].slice(1)]);if(n instanceof K||n.preset!==a.uuid){var r=n.getFirstTaskIn();return null===r?{v:[]}:t.getChoiceKeyToPreset(t.tasks[r],a)===i?"continue":{v:[]}}if(!(i in n.children))return{v:[]};n=n.children[i]}},l=this.presets[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){var u=c();switch(u){case"continue":continue;default:if("object"===typeof u)return u.v}}}catch(h){i=!0,r=h}finally{try{s||null==l.return||l.return()}finally{if(i)throw r}}if(!(n instanceof K))throw new Error("Error in selecting tasks");return Object.values(n.children)}}]),e}(),Q=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={dialogOpen:!1},a.execute=a.execute.bind(Object(h.a)(a)),a.openDialog=a.openDialog.bind(Object(h.a)(a)),a.closeDialog=a.closeDialog.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"execute",value:function(){this.setState({dialogOpen:!1}),fetch(this.props.url).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"openDialog",value:function(){this.setState({dialogOpen:!0})}},{key:"closeDialog",value:function(){this.setState({dialogOpen:!1})}},{key:"render",value:function(){return this.state.dialogOpen?s.a.createElement("div",{className:"prompt-wrapper"},s.a.createElement("div",{className:"prompt"},s.a.createElement("div",{className:"prompt-header"},this.props.header),s.a.createElement("div",{className:"prompt-text"},this.props.text),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.execute},"Yes"),s.a.createElement("div",{onClick:this.closeDialog},"No")))):""}}]),t}(s.a.Component),W=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).reassuringRemovePromptRefs=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("li",{className:this.props.choice.abstract?"item item-abstract item-choice":"item item-choice"},s.a.createElement("div",{className:"content"},s.a.createElement("div",{className:"title"},this.props.choice.name),s.a.createElement("div",{className:"footer"},""!==this.props.choice.base?s.a.createElement("span",null,s.a.createElement("span",null,"Inherits from:")," ",this.props.choice.base):s.a.createElement("span",null,"-"),s.a.createElement("span",null,s.a.createElement("span",null,"Created:")," ",this.props.choice.creation_time.toShortStr()))),s.a.createElement("div",{className:"toolbar"},s.a.createElement("div",{className:"action",onClick:function(){return e.props.editFunc(e.props.choice,!0,e.props.preset,e.props.preset.choices)},title:"Clone choice"},s.a.createElement("i",{className:"far fa-copy"})),s.a.createElement("div",{className:"action",onClick:function(){return e.props.editFunc(e.props.choice,!1,e.props.preset,e.props.preset.choices)},title:"Edit choice"},s.a.createElement("i",{className:"fa fa-edit"})),s.a.createElement("div",{className:"dropdown"},s.a.createElement("div",{className:"action dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-ellipsis-h"})),s.a.createElement("div",{className:"dropdown-menu"},this.props.removable?s.a.createElement("div",{className:"action",onClick:function(){return e.reassuringRemovePromptRefs.current.openDialog()},title:"Remove choice"},s.a.createElement("i",{className:"far fa-trash-alt"})):s.a.createElement("div",{className:"action action-disabled",title:"Choice cannot be removed, as there are tasks using it."},s.a.createElement("i",{className:"far fa-trash-alt"}))))),s.a.createElement(Q,{ref:this.reassuringRemovePromptRefs,header:"Really want to delete?",text:"Do you really want to remove this choice?",url:"/remove_choice/"+this.props.choice.project_name+"/"+this.props.choice.uuid}))}}]),t}(s.a.Component),$=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={hideChoices:!1},a.toggleHideChoices=a.toggleHideChoices.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toggleHideChoices",value:function(){this.setState({hideChoices:!this.state.hideChoices})}},{key:"render",value:function(){var e=this;return s.a.createElement("li",{className:"item item-preset"},""!==this.props.group&&s.a.createElement("div",{className:"group-header",onClick:function(){return e.toggleHideChoices()}},s.a.createElement("div",{className:"title"},this.props.group)),!this.state.hideChoices&&s.a.createElement("ul",null,this.props.presets.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return s.a.createElement(Y,{key:t.uuid,preset:t,editPresetFunc:e.props.editPresetFunc,editChoiceFunc:e.props.editChoiceFunc,newChoiceFunc:e.props.newChoiceFunc,numberOfTasksPerChoice:e.props.numberOfTasksPerChoice})})))}}]),t}(s.a.Component),Y=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={hideChoices:!0},a.toggleHideChoices=a.toggleHideChoices.bind(Object(h.a)(a)),a.onDragStart=a.onDragStart.bind(Object(h.a)(a)),a.onDragOver=a.onDragOver.bind(Object(h.a)(a)),a.onDragEnter=a.onDragEnter.bind(Object(h.a)(a)),a.onDragLeave=a.onDragLeave.bind(Object(h.a)(a)),a.onDrop=a.onDrop.bind(Object(h.a)(a)),a.reassuringRemovePromptRefs=s.a.createRef(),a.presetRef=s.a.createRef(),a.dragEnterCounter=0,a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toggleHideChoices",value:function(){this.setState({hideChoices:!this.state.hideChoices})}},{key:"onDragStart",value:function(e){e.dataTransfer.setData("text/plain",this.props.preset.uuid)}},{key:"onDragOver",value:function(e){this.props.sortMode&&this.props.preset.uuid!==e.dataTransfer.getData("text/plain")&&e.preventDefault()}},{key:"onDrop",value:function(e){this.props.sortMode&&this.props.preset.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),fetch("/reorder_preset/"+this.props.project_name+"/"+e.dataTransfer.getData("text/plain")+"/"+this.props.preset.sorting).then(function(e){return e.json()}).then(function(e){},function(e){}),this.dragEnterCounter=0,this.presetRef.current.className="item item-preset")}},{key:"onDragEnter",value:function(e){this.props.sortMode&&this.props.preset.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),this.presetRef.current.className="item item-preset on-drag-over",this.dragEnterCounter++)}},{key:"onDragLeave",value:function(e){this.props.sortMode&&this.props.preset.uuid!==e.dataTransfer.getData("text/plain")&&(e.preventDefault(),this.dragEnterCounter--,0===this.dragEnterCounter&&(this.presetRef.current.className="item item-preset"))}},{key:"render",value:function(){var e=this;return s.a.createElement("li",{ref:this.presetRef,className:"item item-preset",onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter,onDrop:this.onDrop,onDragStart:this.onDragStart,draggable:this.props.sortMode?"true":"false"},s.a.createElement("div",{className:"header",onClick:function(){return e.toggleHideChoices()}},s.a.createElement("div",{className:"title"},this.props.preset.name),this.props.sortMode?s.a.createElement("div",{className:"toolbar"},s.a.createElement("div",{className:"grip-icon"},s.a.createElement("i",{className:"fas fa-bars"}))):s.a.createElement("div",{className:"toolbar"},s.a.createElement("div",{className:"action",onClick:function(t){e.props.newChoiceFunc(e.props.preset,e.props.preset.choices),t.stopPropagation()},title:"New choice"},s.a.createElement("i",{className:"fas fa-plus"})),s.a.createElement("div",{className:"action",onClick:function(t){e.props.editPresetFunc(e.props.preset),t.stopPropagation()},title:"Edit preset"},s.a.createElement("i",{className:"fa fa-edit"})),0===this.props.preset.choices.length?s.a.createElement("div",{className:"action",onClick:function(){return e.reassuringRemovePromptRefs.current.openDialog()},title:"Remove preset"},s.a.createElement("i",{className:"far fa-trash-alt"})):s.a.createElement("div",{className:"action action-disabled",title:"Preset cannot be removed, as it still has choices."},s.a.createElement("i",{className:"far fa-trash-alt"})))),!this.state.hideChoices&&!this.props.sortMode&&s.a.createElement("ul",null,this.props.preset.choices.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return s.a.createElement(W,{key:t.uuid,choice:t,preset:e.props.preset,editFunc:e.props.editChoiceFunc,removable:!(t.uuid in e.props.numberOfTasksPerChoice)||0===e.props.numberOfTasksPerChoice[t.uuid].length})})),s.a.createElement(Q,{ref:this.reassuringRemovePromptRefs,header:"Really want to delete?",text:"Do you really want to remove this preset?",url:"/remove_preset/"+this.props.preset.project_name+"/"+this.props.preset.uuid}))}}]),t}(s.a.Component),z=(s.a.Component,function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).reassuringRemovePromptRefs=s.a.createRef(),a.itemRef=s.a.createRef(),a.promptExtraRefs=s.a.createRef(),a.openExtraDialog=a.openExtraDialog.bind(Object(h.a)(a)),a.finish=a.finish.bind(Object(h.a)(a)),a.openLog=a.openLog.bind(Object(h.a)(a)),a.clone=a.clone.bind(Object(h.a)(a)),a.pause=a.pause.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"openExtraDialog",value:function(){this.promptExtraRefs.current.openDialog()}},{key:"finish",value:function(){fetch("/finish/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"openLog",value:function(){window.open("/log/"+this.props.task.uuid,"_blank")}},{key:"clone",value:function(){fetch("/clone_task/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"componentDidUpdate",value:function(e,t,a){e.highlight!==this.props.highlight&&this.props.highlight&&this.itemRef.current.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"componentDidMount",value:function(){this.props.highlight&&this.itemRef.current.scrollIntoView({behavior:"smooth",block:"start"})}},{key:"itemClass",value:function(){var e="item item-task ";return this.props.highlight&&(e+="item-highlight "),this.props.task.state===p.RUNNING&&(e+="task-running "),e}},{key:"pause",value:function(){fetch("/pause/"+this.props.task.uuid).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"render",value:function(){var e=this;return s.a.createElement("li",{ref:this.itemRef,className:this.itemClass()},s.a.createElement("div",{className:"content"},s.a.createElement("div",{className:"title"},s.a.createElement("span",{className:"try-number"},this.props.task.try),s.a.createElement(V,{task:this.props.task})),s.a.createElement("div",{className:"footer"},s.a.createElement("span",null,s.a.createElement("span",null,"Iterations:")," ",this.props.task.finished_iterations," / ",this.props.task.total_iterations),s.a.createElement("span",null,s.a.createElement("span",null,"Created:")," ",this.props.task.creation_time.toShortStr()),s.a.createElement("span",null,s.a.createElement("span",null,"Last saved:")," ",this.props.task.saved_time.toShortStr()," ",1==this.props.task.had_error&&s.a.createElement("span",{className:"task-error"},"(Error)")))),s.a.createElement("div",{className:"toolbar"},this.props.task.state===p.RUNNING?s.a.createElement("div",{className:"action",onClick:this.pause,title:"Pause task"},s.a.createElement("i",{className:"fa fa-pause"})):s.a.createElement("div",{className:"action",onClick:this.openExtraDialog,title:"Run for more iterations"},s.a.createElement("i",{className:"fa fa-play"})),s.a.createElement("div",{className:"action",onClick:function(){return e.props.showTask(e.props.task)},title:"Show detail information"},s.a.createElement("i",{className:"fa fa-info"})),s.a.createElement("div",{className:"dropdown"},s.a.createElement("div",{className:"action dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.a.createElement("i",{className:"fas fa-ellipsis-h"})),s.a.createElement("div",{className:"dropdown-menu"},s.a.createElement("div",{className:"action",onClick:function(){return e.props.rerunTask(e.props.task)},title:"Run new task with the exact same config"},s.a.createElement("i",{className:"fa fa-redo"})),!this.props.task.is_test&&s.a.createElement("div",{className:"action",onClick:function(){return e.props.filterLikeTask(e.props.task)},title:"Filter for similar tasks"},s.a.createElement("i",{className:"fas fa-sliders-h"})),s.a.createElement("div",{className:"action",onClick:this.clone,title:"Clone task"},s.a.createElement("i",{className:"far fa-copy"})),s.a.createElement("div",{className:"action",onClick:this.openLog,title:"View log"},s.a.createElement("i",{className:"far fa-file-alt"})),this.props.task.state!==p.RUNNING&&s.a.createElement("div",{className:"action",onClick:function(){return e.reassuringRemovePromptRefs.current.openDialog()},title:"Remove task"},s.a.createElement("i",{className:"far fa-trash-alt"}))))),s.a.createElement(R,{ref:this.promptExtraRefs,devices:this.props.devices,defaultValue:this.props.task.total_iterations,header:"Change total iterations?",text:"Specify the new number of iterations, you want the task to run:",url:"/continue/"+this.props.task.uuid}),s.a.createElement(Q,{ref:this.reassuringRemovePromptRefs,header:"Really want to delete?",text:"Do you really want to remove this task?",url:"/remove_task/"+this.props.task.uuid}))}}]),t}(s.a.Component)),X=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={preset:null,name:"",deprecatedChoice:"",defaultChoice:""},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.save=a.save.bind(Object(h.a)(a)),a.new=a.new.bind(Object(h.a)(a)),a.onNameChange=a.onNameChange.bind(Object(h.a)(a)),a.onDeprecatedChoiceChange=a.onDeprecatedChoiceChange.bind(Object(h.a)(a)),a.onDefaultChoiceChange=a.onDefaultChoiceChange.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(e){this.props.closeEditors(),this.setState({preset:e,name:e.name,deprecatedChoice:e.deprecated_choice.uuid,defaultChoice:e.default_choice.uuid})}},{key:"new",value:function(e){this.props.closeEditors(),this.setState({preset:{name:"New preset",project_name:e,choices:[]},name:"",deprecatedChoice:"",defaultChoice:""})}},{key:"close",value:function(){this.setState({preset:null})}},{key:"save",value:function(){var e=new FormData,t={};t.name=this.state.name,t.deprecated_choice=this.state.deprecatedChoice,t.default_choice=this.state.defaultChoice,t.config={},e.append("data",JSON.stringify(t));var a="";a=this.state.preset.uuid?"/edit_preset/"+this.state.preset.project_name+"/"+this.state.preset.uuid:"/add_preset/"+this.state.preset.project_name,fetch(a,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){}),this.close()}},{key:"onNameChange",value:function(e){this.setState({name:e.target.value})}},{key:"onDeprecatedChoiceChange",value:function(e){this.setState({deprecatedChoice:e.target.value})}},{key:"onDefaultChoiceChange",value:function(e){this.setState({defaultChoice:e.target.value})}},{key:"render",value:function(){return null!==this.state.preset?s.a.createElement("div",{className:"preset-editor editor"},s.a.createElement("div",{className:"header"},this.state.preset.name),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Name:"),s.a.createElement("input",{value:this.state.name,onChange:this.onNameChange,required:"required"})),this.state.preset.choices.length>0&&s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Choice for deprecated tasks:"),s.a.createElement("select",{value:this.state.deprecatedChoice,onChange:this.onDeprecatedChoiceChange},this.state.preset.choices.map(function(e){return s.a.createElement("option",{value:e.uuid},e.name)}))),this.state.preset.choices.length>0&&s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Default choice for new tasks:"),s.a.createElement("select",{value:this.state.defaultChoice,onChange:this.onDefaultChoiceChange},this.state.preset.choices.map(function(e){return s.a.createElement("option",{value:e.uuid},e.name)}))),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.save},"Save"),s.a.createElement("div",{onClick:this.close},"Cancel"))):""}}]),t}(s.a.Component),Z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={choice:null,name:"",base:"",abstract:!1,dynamic:!1,forceDynamic:!1,possible_base_choices:[],uuid_to_load:null,preset:null},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.save=a.save.bind(Object(h.a)(a)),a.new=a.new.bind(Object(h.a)(a)),a.onNameChange=a.onNameChange.bind(Object(h.a)(a)),a.onBaseChange=a.onBaseChange.bind(Object(h.a)(a)),a.onAbstractChange=a.onAbstractChange.bind(Object(h.a)(a)),a.onDynamicChange=a.onDynamicChange.bind(Object(h.a)(a)),a.onIsBaseDynamic=a.onIsBaseDynamic.bind(Object(h.a)(a)),a.onTemplateChange=a.onTemplateChange.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(e,t,a,n){this.props.closeEditors(),t?this.setState({choice:{name:e.name,project_name:e.project_name},name:e.name,base:e.base_uuid,uuid_to_load:e.uuid,abstract:e.abstract,dynamic:e.dynamic,template:e.isTemplate,forceDynamic:!1,preset:a,possible_base_choices:n}):this.setState({choice:e,name:e.name,base:e.base_uuid,uuid_to_load:e.uuid,abstract:e.abstract,dynamic:e.dynamic,template:e.isTemplate,forceDynamic:!1,preset:a,possible_base_choices:n})}},{key:"new",value:function(e,t){this.props.closeEditors(),this.setState({choice:{name:"New choice",project_name:e.project_name},name:"",base:"",abstract:!1,dynamic:!1,uuid_to_load:null,forceDynamic:!1,preset:e,possible_base_choices:t})}},{key:"close",value:function(){this.setState({choice:null})}},{key:"save",value:function(){var e=new FormData,t={};""!==this.state.name&&(t.name=this.state.name),""!==this.state.base&&(t.base=this.state.base),this.state.abstract&&(t.abstract=this.state.abstract),this.state.dynamic&&(t.dynamic=this.state.dynamic),this.state.template&&(t.isTemplate=this.state.template),t.config=this.configEditor.current.state.config,e.append("data",JSON.stringify(t));var a="";a=this.state.choice.uuid?"/edit_choice/"+this.state.preset.project_name+"/"+this.state.preset.uuid+"/"+this.state.choice.uuid:"/add_choice/"+this.state.preset.project_name+"/"+this.state.preset.uuid,fetch(a,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){}),this.close()}},{key:"onNameChange",value:function(e){this.setState({name:e.target.value})}},{key:"onBaseChange",value:function(e){this.setState({base:e.target.value})}},{key:"onAbstractChange",value:function(e){this.setState({abstract:e.target.checked})}},{key:"onDynamicChange",value:function(e){this.setState({dynamic:e.target.checked})}},{key:"onIsBaseDynamic",value:function(e){e?this.setState({dynamic:!0,forceDynamic:!0}):this.state.forceDynamic&&this.setState({dynamic:!1,forceDynamic:!1})}},{key:"onTemplateChange",value:function(e){this.setState({template:e.target.checked})}},{key:"render",value:function(){var e=this;return null!==this.state.choice?s.a.createElement("div",{className:"choice-editor editor"},s.a.createElement("div",{className:"header"},this.state.choice.name),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Name:"),s.a.createElement("input",{value:this.state.name,onChange:this.onNameChange,required:"required"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Base:"),s.a.createElement("select",{value:this.state.base,onChange:this.onBaseChange},s.a.createElement("option",{value:""},"None"),this.state.possible_base_choices.filter(function(t){return t.uuid!==e.state.uuid_to_load}).map(function(e){return s.a.createElement("option",{value:e.uuid},e.name)}))),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Abstract:"),s.a.createElement("input",{checked:this.state.abstract,onChange:this.onAbstractChange,type:"checkbox"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Dynamic:"),s.a.createElement("input",{checked:this.state.dynamic,onChange:this.onDynamicChange,type:"checkbox",disabled:this.state.forceDynamic})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Template:"),s.a.createElement("input",{checked:this.state.template,onChange:this.onTemplateChange,type:"checkbox"})),s.a.createElement(D,{ref:this.configEditor,onDynamicChange:this.onIsBaseDynamic,url:"/config/choice/"+this.state.choice.project_name+(null!==this.state.uuid_to_load?"/"+this.state.uuid_to_load:""),bases:[this.state.base]}),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.save},"Save"),s.a.createElement("div",{onClick:this.close},"Cancel"))):""}}]),t}(s.a.Component),ee=(s.a.Component,function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a.mapChoiceToChoices=a.mapChoiceToChoices.bind(Object(h.a)(a)),a.calcChoiceName=a.calcChoiceName.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"calcChoiceName",value:function(e,t){for(var a=e.name,n=0;n<t.length;n++)a=a.replace("$T"+n+"$",t[n]);return a}},{key:"calcChoiceClasses",value:function(e,t){var a="choice ";return!(e.uuid in this.props.selectedChoices&&this.props.selectedChoices[e.uuid][0]===t.uuid)||"resolvedName"in t&&this.calcChoiceName(t,this.props.selectedChoices[e.uuid].slice(1))!==t.resolvedName||(a+="choice-selected "),e.default_choice.uuid===t.uuid&&(a+="choice-default "),a}},{key:"mapChoiceToChoices",value:function(e){var t=[];if(e.isTemplate){if(e.uuid in this.props.numberOfTasksPerChoice){var a={},n=!0,s=!1,i=void 0;try{for(var r,o=this.props.numberOfTasksPerChoice[e.uuid][Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,l=this.calcChoiceName(e,c.slice(1));l in a||(a[l]=[0,c.slice(1)]),a[l][0]++}}catch(h){s=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}for(var u in a)t.push({uuid:e.uuid,name:e.name,resolvedName:u,numberOfTasks:a[u][0],args:a[u][1]})}}else t.push({uuid:e.uuid,name:e.name,resolvedName:e.name,numberOfTasks:this.props.numberOfTasksPerChoice&&e.uuid in this.props.numberOfTasksPerChoice?this.props.numberOfTasksPerChoice[e.uuid].length:0,args:[]});return t}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"preset-filter"},Object.keys(this.props.presetsByGroup).sort(function(e,t){return e.localeCompare(t)}).map(function(t){return s.a.createElement("div",{key:t,className:"preset-group"},""!==t&&s.a.createElement("div",{className:"group-header",onClick:function(){return e.toggleHideChoices()}},s.a.createElement("div",{className:"title"},t)),s.a.createElement("div",{className:"presets"},e.props.presetsByGroup[t].sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return s.a.createElement("div",{key:t.uuid,className:"preset"},s.a.createElement("div",{className:"preset-name"},t.name),s.a.createElement("div",{className:"choices-wrapper"},s.a.createElement("div",{className:"choices"},t.choices.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(a){return a.isTemplate&&e.props.useTemplateFields?s.a.createElement("div",{key:a.uuid,className:e.calcChoiceClasses(t,a),onClick:function(){return e.props.onSelectionChange(t,a,e.props.selectedChoices[t.uuid][1])}},s.a.createElement(s.a.Fragment,null,a.name.split("$T0$")[0],s.a.createElement("input",{value:t.uuid in e.props.selectedChoices?e.props.selectedChoices[t.uuid][1]:"",style:{width:Math.max(10,10*(t.uuid in e.props.selectedChoices&&void 0!==e.props.selectedChoices[t.uuid][1]?e.props.selectedChoices[t.uuid][1]:"").length)+"px"},onChange:function(n){return e.props.onSelectionChange(t,a,n.target.value)}}),a.name.split("$T0$")[1])):e.mapChoiceToChoices(a).map(function(a){return s.a.createElement("div",{key:a.uuid,className:e.calcChoiceClasses(t,a),onClick:function(){return e.props.onSelectionChange(t,a,a.args)}},s.a.createElement(s.a.Fragment,null,a.resolvedName,e.props.numberOfTasksPerChoice&&s.a.createElement("span",{className:"task-numbers"},a.numberOfTasks)))})}))))})))}))}}]),t}(s.a.Component)),te=function(e){function t(e){var a;Object(o.a)(this,t),a=Object(l.a)(this,Object(u.a)(t).call(this,e));var n={},i=!0,r=!1,c=void 0;try{for(var d,p=e.presets[Symbol.iterator]();!(i=(d=p.next()).done);i=!0){var m=d.value;m.choices.length>0&&(n[m.uuid]=[m.choices[0].uuid])}}catch(f){r=!0,c=f}finally{try{i||null==p.return||p.return()}finally{if(r)throw c}}return a.state={selectedChoices:n,uuid_to_load:null,total_iterations:"",save_interval:"0",checkpoint_interval:"0",open:!1,command:"",commandHint:"",isTest:!1,device:null},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.run=a.run.bind(Object(h.a)(a)),a.new=a.new.bind(Object(h.a)(a)),a.onSelectionChange=a.onSelectionChange.bind(Object(h.a)(a)),a.onTotalIterationsChange=a.onTotalIterationsChange.bind(Object(h.a)(a)),a.onCheckpointIntervalChange=a.onCheckpointIntervalChange.bind(Object(h.a)(a)),a.onSaveIntervalChange=a.onSaveIntervalChange.bind(Object(h.a)(a)),a.copyCommand=a.copyCommand.bind(Object(h.a)(a)),a.onIsTestChange=a.onIsTestChange.bind(Object(h.a)(a)),a.onDeviceChange=a.onDeviceChange.bind(Object(h.a)(a)),a.wrapperRef=s.a.createRef(),a.commandInput=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(e){var t=Object.assign({},this.state.selectedChoices),a=!0,n=!1,s=void 0;try{for(var i,r=this.props.presets[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value,c=null,l=[],u=!0,h=!1,d=void 0;try{for(var p,m=e.choices[Symbol.iterator]();!(u=(p=m.next()).done);u=!0){var f=p.value;if(f[0].preset===o.uuid){c=f[0],l=f.slice(1);break}}}catch(v){h=!0,d=v}finally{try{u||null==m.return||m.return()}finally{if(h)throw d}}t[o.uuid]=null===c?[o.deprecated_choice.uuid].concat(Object(L.a)(l)):[c.uuid].concat(Object(L.a)(l))}}catch(v){n=!0,s=v}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}this.setState({selectedChoices:t,open:!0,isTest:e.is_test,device:this.props.devices[0].uuid}),this.updateCommand(t)}},{key:"new",value:function(){var e=Object.assign({},this.state.selectedChoices),t=!0,a=!1,n=void 0;try{for(var s,i=this.props.presets[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var r=s.value;r.uuid in e||(e[r.uuid]=[r.default_choice.uuid])}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}this.setState({selectedChoices:e,open:!0,device:this.props.devices[0].uuid}),this.updateCommand(e)}},{key:"close",value:function(){this.setState({choice:null,open:!1})}},{key:"run",value:function(){var e=new FormData,t={};t.choices=this.state.selectedChoices,t.config={save_interval:parseInt(this.state.save_interval),checkpoint_interval:parseInt(this.state.checkpoint_interval)},t.device=this.state.device,e.append("data",JSON.stringify(t));var a="/"+(this.state.isTest?"test":"start")+"/"+this.props.project_name+"/"+this.state.total_iterations;fetch(a,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){}),this.close()}},{key:"onSelectionChange",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Object.assign({},this.state.selectedChoices);n[e.uuid]=[t.uuid],null!==a&&n[e.uuid].push(a),this.setState({selectedChoices:n}),this.updateCommand(n)}},{key:"onTotalIterationsChange",value:function(e){this.setState({total_iterations:e.target.value}),this.updateCommand(null,e.target.value)}},{key:"onSaveIntervalChange",value:function(e){this.setState({save_interval:e.target.value})}},{key:"onCheckpointIntervalChange",value:function(e){this.setState({checkpoint_interval:e.target.value})}},{key:"updateCommand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===e&&(e=this.state.selectedChoices),null===t&&(t=this.state.total_iterations);var a="",n=!0,s=!1,i=void 0;try{for(var r,o=this.props.presets[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value;if(c.uuid in e){a+=c.uuid+" "+e[c.uuid][0];for(var l=1;l<e[c.uuid].length;l++)a+=':"'+e[c.uuid][l]+'"';a+=" "}}}catch(u){s=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}""!==t?this.setState({command:"taskplan "+(this.state.isTest?"test ":"start ")+this.props.project_name+" "+t+" "+a,commandHint:"Click to copy"}):this.setState({command:"",commandHint:"Total iterations missing"})}},{key:"componentDidMount",value:function(){x()(this.wrapperRef.current).find('[data-toggle="tooltip"]').tooltip()}},{key:"componentDidUpdate",value:function(){x()(this.wrapperRef.current).find('[data-toggle="tooltip"]').tooltip()}},{key:"copyCommand",value:function(){var e=this;this.commandInput.current.select(),document.execCommand("copy"),this.setState({commandHint:"Copied!"},function(){return x()(e.commandInput.current).tooltip("show")})}},{key:"onIsTestChange",value:function(e){var t=this;this.setState({isTest:e.target.checked},function(){return t.updateCommand()})}},{key:"onDeviceChange",value:function(e){this.setState({device:e.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{ref:this.wrapperRef,style:{display:this.state.open?"block":"none"}},s.a.createElement("div",{className:"task-editor slide-editor editor"},s.a.createElement("div",{className:"header"},"Start task",s.a.createElement("i",{className:"fas fa-times",onClick:this.close})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Total iterations:"),s.a.createElement("input",{value:this.state.total_iterations,onChange:this.onTotalIterationsChange,required:"required"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Save interval:"),s.a.createElement("input",{value:this.state.save_interval,onChange:this.onSaveIntervalChange,required:"required"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Checkpoint interval:"),s.a.createElement("input",{value:this.state.checkpoint_interval,onChange:this.onCheckpointIntervalChange,required:"required"})),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Is test:"),s.a.createElement("input",{checked:this.state.isTest,onChange:this.onIsTestChange,type:"checkbox"})),s.a.createElement(ee,{presetsByGroup:this.props.presetsByGroup,selectedChoices:this.state.selectedChoices,onSelectionChange:this.onSelectionChange,useTemplateFields:!0}),s.a.createElement(D,{ref:this.configEditor,url:"/config/task/"+this.props.project_name,bases:Object.values(this.state.selectedChoices),preview:!0}),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Device:"),s.a.createElement("select",{value:this.state.device,onChange:this.onDeviceChange},this.props.devices.map(function(e){return s.a.createElement("option",{value:e.uuid},e.name)}))),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Command:"),s.a.createElement("input",{className:"command",ref:this.commandInput,onClick:this.copyCommand,"data-toggle":"tooltip","data-placement":"bottom","data-original-title":this.state.commandHint,value:this.state.command,readOnly:!0})),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.run},"Run"))))}}]),t}(s.a.Component),ae=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",null,this.props.presets[0].name),s.a.createElement("ul",null,Object.keys(this.props.tasksPerChoice).map(function(t){return s.a.createElement("li",null,s.a.createElement("div",null,e.props.presets[0].choices.find(function(e){return e.uuid===t}).name),s.a.createElement(se,{presets:e.props.presets.slice(1),tasks:e.props.tasksPerChoice[t]}))})))}}]),t}(s.a.Component),ne=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,this.props.tasks.map(function(t){return s.a.createElement(z,{rerunTask:e.rerunTask,key:t.uuid,task:t})}))}}]),t}(s.a.Component),se=function(e){function t(e){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.presets.slice(0),a={},n=function(){var n=t[0];if(""===n.deprecated_choice)return"continue";a={};var s=!0,i=!1,r=void 0;try{for(var o,c=e.props.tasks[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var l=o.value,u=l.choices.find(function(e){return e.preset===n.uuid});u=void 0===u?n.deprecated_choice.uuid:u.uuid,a.hasOwnProperty(u)||(a[u]=[]),a[u].push(l)}}catch(h){i=!0,r=h}finally{try{s||null==c.return||c.return()}finally{if(i)throw r}}if(Object.keys(a).length>1)return"break";t.shift()};e:for(;t.length>0;){switch(n()){case"continue":continue;case"break":break e}}return t.length>0?s.a.createElement(ae,{tasksPerChoice:a,presets:t}):s.a.createElement(ne,{tasks:this.props.tasks})}}]),t}(s.a.Component),ie=(s.a.Component,function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={open:!1},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.save=a.save.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(){this.props.closeEditors(),this.setState({open:!0})}},{key:"close",value:function(){this.setState({open:!1})}},{key:"save",value:function(){var e=new FormData,t={};t.config=this.configEditor.current.state.config,e.append("data",JSON.stringify(t));var a="/add_preset_batch/"+this.props.project_name;fetch(a,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){}),this.close()}},{key:"render",value:function(){return this.state.open?s.a.createElement("div",{className:"preset-batch-editor editor"},s.a.createElement("div",{className:"header"},"Add multiple presets"),s.a.createElement(D,{ref:this.configEditor,url:""}),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.save},"Save"),s.a.createElement("div",{onClick:this.close},"Cancel"))):""}}]),t}(s.a.Component)),re=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={showAbstract:!0},a.toggleShowAbstract=a.toggleShowAbstract.bind(Object(h.a)(a)),a.addPreset=a.addPreset.bind(Object(h.a)(a)),a.addPresetBatch=a.addPresetBatch.bind(Object(h.a)(a)),a.closeEditors=a.closeEditors.bind(Object(h.a)(a)),a.presetEditor=s.a.createRef(),a.presetBatchEditor=s.a.createRef(),a.choiceEditor=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"toggleShowAbstract",value:function(){this.setState({showAbstract:!this.state.showAbstract})}},{key:"closeEditors",value:function(){this.presetEditor.current.close(),this.presetBatchEditor.current.close(),this.choiceEditor.current.close()}},{key:"addPreset",value:function(){this.presetEditor.current.new(this.props.project.name)}},{key:"addPresetBatch",value:function(){this.presetBatchEditor.current.open()}},{key:"addChoice",value:function(e){this.choiceEditor.current.new(e)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"tab",style:{display:this.props.active?"flex":"none"}},s.a.createElement("ul",{className:"presets-tab"},this.props.presetSortingMode?this.props.presets.sort(function(e,t){return e.sorting-t.sorting}).map(function(t){return s.a.createElement(Y,{key:t.uuid,preset:t,sortMode:!0,project_name:e.props.project.name,numberOfTasksPerChoice:e.props.numberOfTasksPerChoice})}):Object.keys(this.props.presetsByGroup).sort(function(e,t){return e.localeCompare(t)}).map(function(t){return s.a.createElement($,{key:t,presets:e.props.presetsByGroup[t],group:t,sorting:e.props.sorting[0],sortingDescending:e.props.sortingDescending[0],editPresetFunc:e.presetEditor.current.open,editChoiceFunc:e.choiceEditor.current.open,newChoiceFunc:e.choiceEditor.current.new,numberOfTasksPerChoice:e.props.numberOfTasksPerChoice})})),s.a.createElement(X,{ref:this.presetEditor,closeEditors:this.closeEditors}),s.a.createElement(Z,{ref:this.choiceEditor,closeEditors:this.closeEditors}),s.a.createElement(ie,{ref:this.presetBatchEditor,closeEditors:this.closeEditors,project_name:this.props.project.name}),s.a.createElement("div",{className:"tab-toolbar"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",defaultChecked:this.state.showAbstract,onChange:this.toggleShowAbstract}),s.a.createElement("span",null,"Show abstract presets")),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.addPreset},"Add preset"),s.a.createElement("div",{onClick:this.addPresetBatch},"Add batch"))))}}]),t}(s.a.Component),oe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={task:null,selectedChoices:{},notes:""},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.updateTasks=a.updateTasks.bind(Object(h.a)(a)),a.extractCheckpoint=a.extractCheckpoint.bind(Object(h.a)(a)),a.notesTextarea=s.a.createRef(),a.updateNotes=a.updateNotes.bind(Object(h.a)(a)),a.timer=null,a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.repository.onChange("tasks",this.updateTasks)}},{key:"componentWillUnmount",value:function(){this.props.repository.removeOnChange("tasks",this.updateTasks)}},{key:"open",value:function(e){var t={},a=!0,n=!1,s=void 0;try{for(var i,r=this.props.presets[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value,c=null,l=[],u=!0,h=!1,d=void 0;try{for(var p,m=e.choices[Symbol.iterator]();!(u=(p=m.next()).done);u=!0){var f=p.value;if(f[0].preset===o.uuid){c=f[0],l=f.slice(1);break}}}catch(k){h=!0,d=k}finally{try{u||null==m.return||m.return()}finally{if(h)throw d}}if(null===c)t[o.uuid]=o.deprecated_choice.name;else{t[o.uuid]=c.name;for(var v=0;v<l.length;v++)t[o.uuid]=t[o.uuid].replace("$T"+v+"$",l[v])}}}catch(k){n=!0,s=k}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}this.setState({task:e,selectedChoices:t,notes:e.notes})}},{key:"updateTasks",value:function(e){null!==this.state.task&&this.setState({task:this.state.task.uuid in e?e[this.state.task.uuid]:null})}},{key:"close",value:function(){this.setState({task:null})}},{key:"extractCheckpoint",value:function(e){fetch("/extract_checkpoint/"+this.state.task.uuid+"/"+e).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"updateNotes",value:function(e){var t=e.target.value,a=this.state.task.uuid;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var e=new FormData,n={};n.notes=t,e.append("data",JSON.stringify(n)),fetch("set_task_notes/"+a,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){},function(e){})},1e3),this.setState({notes:t})}},{key:"render",value:function(){var e=this;return null!==this.state.task?s.a.createElement("div",{className:"task-viewer slide-editor editor"},s.a.createElement("div",{className:"header"},"Task details",s.a.createElement("i",{class:"fas fa-times",onClick:this.close})),s.a.createElement("div",{className:"title"},s.a.createElement("span",{className:"try-number"},this.state.task.try),s.a.createElement(V,{task:this.state.task})),s.a.createElement("div",{className:"metadata"},s.a.createElement("div",null,s.a.createElement("span",null,"Status:")," ",this.state.task.state===p.RUNNING?"Running":this.state.task.state===p.QUEUED?"Queued":"Stopped"),s.a.createElement("div",null,s.a.createElement("span",null,"Iterations:")," ",this.state.task.finished_iterations," / ",this.state.task.total_iterations),s.a.createElement("div",null,s.a.createElement("span",null,"Started:")," ",this.state.task.creation_time.toShortStr()),s.a.createElement("div",null,s.a.createElement("span",null,"Paused:")," ",this.state.task.saved_time.toShortStr()," ",1==this.state.task.had_error&&s.a.createElement("span",{className:"task-error"},"(Error)")),s.a.createElement("div",null,s.a.createElement("span",null,"Project:")," ",this.state.task.project_name),s.a.createElement("div",null,s.a.createElement("span",null,"Code version:")," ",this.props.codeVersions[this.state.task.version].name)),s.a.createElement(D,{ref:this.configEditor,url:"/config/task_timestep/"+this.state.task.uuid+"/0",bases:[],preview:!0}),s.a.createElement("h2",null,"Notes:"),s.a.createElement("div",{className:"notes"},s.a.createElement("textarea",{ref:this.notesTextarea,value:this.state.notes,onChange:function(t){return e.updateNotes(t)}})),s.a.createElement("h2",null,"Presets"),s.a.createElement("div",{className:"presets"},this.props.presets.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return s.a.createElement("div",null,s.a.createElement("span",null,t.name,":"),e.state.selectedChoices[t.uuid])})),s.a.createElement("h2",null,"Checkpoints"),s.a.createElement("div",{className:"checkpoints"},this.state.task.checkpoints.length>0?this.state.task.checkpoints.map(function(t,a){return s.a.createElement("div",null,s.a.createElement("span",{className:"iteration"},t.finished_iterations),s.a.createElement("span",{className:"time"},t.time.toShortStr()),s.a.createElement("div",{className:"action",onClick:function(){return e.extractCheckpoint(a)},title:"Add task based on checkpoint"},s.a.createElement("i",{className:"fas fa-arrow-right"})))}):s.a.createElement("span",null,"No checkpoints exist"))):""}}]),t}(s.a.Component),ce=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={open:!1},a.configEditor=s.a.createRef(),a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(){this.setState({open:!0})}},{key:"close",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this;return this.state.open?s.a.createElement("div",{className:"preset-viewer slide-editor editor"},s.a.createElement("div",{className:"header"},"Preset filter",s.a.createElement("i",{className:"fas fa-times",onClick:this.close})),s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.props.presetFilterEnabled,onChange:function(){return e.props.togglePresetFilter()}}),s.a.createElement("span",null,"Enabled")),s.a.createElement(ee,{presetsByGroup:this.props.presetsByGroup,numberOfTasksPerChoice:this.props.numberOfTasksPerChoice,selectedChoices:this.props.selectedChoices,onSelectionChange:this.props.onSelectionChange})):""}}]),t}(s.a.Component),le=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a.newTask=a.newTask.bind(Object(h.a)(a)),a.rerunTask=a.rerunTask.bind(Object(h.a)(a)),a.closeEditors=a.closeEditors.bind(Object(h.a)(a)),a.taskEditor=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"closeEditors",value:function(){this.taskEditor.current.close()}},{key:"newTask",value:function(){this.taskEditor.current.new()}},{key:"rerunTask",value:function(e){this.taskEditor.current.open(e)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"tab",style:{display:this.props.active?"flex":"none"}},s.a.createElement("ul",{className:"tasks-tab"},this.props.selectedTasks.filter(function(t){return t in e.props.tasks}).map(function(t){return e.props.tasks[t]}).sort(function(t,a){var n;switch(e.props.sorting[1]){case 0:n=t.saved_time-a.saved_time;break;case 1:n=t.preset_name.localeCompare(a.preset_name);break;case 2:n=t.creation_time-a.creation_time;break;case 3:n=t.finished_iterations-a.finished_iterations}return 0===n&&(n=t.try-a.try),e.props.sortingDescending[1]&&(n*=-1),n}).map(function(t){return s.a.createElement(z,{rerunTask:e.rerunTask,key:t.uuid,task:t,showTask:e.props.showTask,highlight:t.uuid===e.props.highlightedTask,filterLikeTask:e.props.filterLikeTask,devices:e.props.devices})})),s.a.createElement(te,{devices:this.props.devices,ref:this.taskEditor,presets:this.props.presets,presetsByGroup:this.props.presetsByGroup,project_name:this.props.project.name}),s.a.createElement("div",{className:"tab-toolbar"},s.a.createElement("label",null),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:this.newTask},"New task"))))}}]),t}(s.a.Component),ue=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={presets:[],presetsByGroup:{},tasks:[],activeTab:0,sorting:[0,0],sortingDescending:[!0,!0],selectedChoices:{},selectedTasks:[],presetFilterEnabled:!1,presetSortingMode:!1,numberOfTasksPerChoice:{}},a.updateTasks=a.updateTasks.bind(Object(h.a)(a)),a.updatePresets=a.updatePresets.bind(Object(h.a)(a)),a.addTask=a.addTask.bind(Object(h.a)(a)),a.removeTask=a.removeTask.bind(Object(h.a)(a)),a.toggleShowAbstract=a.toggleShowAbstract.bind(Object(h.a)(a)),a.showTab=a.showTab.bind(Object(h.a)(a)),a.onChangeSorting=a.onChangeSorting.bind(Object(h.a)(a)),a.switchSortingDirection=a.switchSortingDirection.bind(Object(h.a)(a)),a.openPresetViewer=a.openPresetViewer.bind(Object(h.a)(a)),a.onSelectionChange=a.onSelectionChange.bind(Object(h.a)(a)),a.togglePresetFilter=a.togglePresetFilter.bind(Object(h.a)(a)),a.togglePresetSortingMode=a.togglePresetSortingMode.bind(Object(h.a)(a)),a.filterLikeTask=a.filterLikeTask.bind(Object(h.a)(a)),a.filterView=new q(!0),a.presetViewerRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){for(var e in this.props.repository.onChange("tasks",this.updateTasks),this.props.repository.onChange("presets",this.updatePresets),this.props.repository.onAdd("tasks",this.addTask),this.props.repository.onRemove("tasks",this.removeTask),this.updatePresets(this.props.repository.presets),this.props.repository.tasks)this.addTask(this.props.repository.tasks[e])}},{key:"componentWillUnmount",value:function(){this.props.repository.removeOnChange("tasks",this.updateTasks),this.props.repository.removeOnChange("presets",this.updatePresets),this.props.repository.removeOnAdd("tasks",this.addTask),this.props.repository.removeOnRemove("tasks",this.removeTask)}},{key:"addTask",value:function(e){var t=Object.assign({},this.state.numberOfTasksPerChoice);if(!e.is_test){e.project_name===this.props.project.name&&this.filterView.addTask(e);var a=!0,n=!1,s=void 0;try{for(var i,r=e.choices[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;o[0].uuid in t||(t[o[0].uuid]=[]),t[o[0].uuid].push([e.uuid,o.slice(1)])}}catch(l){n=!0,s=l}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}var c=Object.assign({},this.state.tasks);c[e.uuid]=e,this.setState({tasks:c,numberOfTasksPerChoice:t}),this.updateVisibleTasks()}},{key:"removeTask",value:function(e){if(!e.is_test){var t=Object.assign({},this.state.numberOfTasksPerChoice),a=!0,n=!1,s=void 0;try{for(var i,r=e.choices[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;if(o[0].uuid in t){var c=t[o[0].uuid].findIndex(function(t){return t[0]===e.uuid});t[o[0].uuid].splice(c,1)}}}catch(l){n=!0,s=l}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}this.setState({numberOfTasksPerChoice:t})}e.project_name!==this.props.project.name||e.is_test||this.filterView.removeTask(e),this.updateVisibleTasks()}},{key:"updateVisibleTasks",value:function(){var e,t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===a&&(a=this.state.selectedChoices),null===n&&(n=this.state.presetFilterEnabled),e=n?this.filterView.getSelectedTask(a,this.props.project.current_code_version):Object.keys(this.state.tasks).filter(function(e){return t.state.tasks[e].version===t.props.project.current_code_version}),this.setState({selectedTasks:e})}},{key:"updatePresets",value:function(e){this.filterView.updatePresets(Object.values(e));for(var t=Object.assign({},this.state.selectedChoices),a={},n=0,s=Object.values(e);n<s.length;n++){var i=s[n];!(i.uuid in t)&&i.choices.length>0&&(t[i.uuid]=[i.choices[0].uuid]);var r=i.group.length>0?i.group[0]:"";r in a||(a[r]=[]),a[r].push(i)}this.setState({presets:Object.values(e),selectedChoices:t,presetsByGroup:a})}},{key:"updateTasks",value:function(e){for(var t in e)e[t].project_name===this.props.project.name&&this.filterView.updateTask(e[t]);this.setState({tasks:e})}},{key:"toggleShowAbstract",value:function(){this.setState({showAbstract:!this.state.showAbstract})}},{key:"showTab",value:function(e){this.setState({activeTab:e})}},{key:"onChangeSorting",value:function(e){var t=this.state.sorting.slice();t[this.state.activeTab]=parseInt(e.target.value),this.setState({sorting:t})}},{key:"switchSortingDirection",value:function(){var e=this.state.sortingDescending.slice();e[this.state.activeTab]=!e[this.state.activeTab],this.setState({sortingDescending:e})}},{key:"onSelectionChange",value:function(e,t,a){var n=Object.assign({},this.state.selectedChoices);n[e.uuid]=[t.uuid].concat(Object(L.a)(a)),this.updateVisibleTasks(n),this.setState({selectedChoices:n})}},{key:"filterLikeTask",value:function(e){var t=this,a=Object.assign({},this.state.selectedChoices),n=!0,s=!1,i=void 0;try{for(var r,o=this.state.presets[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,l=this.filterView.getChoiceToPreset(e,c);a[c.uuid]=[l[0].uuid].concat(Object(L.a)(l[1]))}}catch(u){s=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}this.setState({selectedChoices:a,presetFilterEnabled:!0},function(){return t.updateVisibleTasks()}),this.openPresetViewer()}},{key:"togglePresetFilter",value:function(){var e=!this.state.presetFilterEnabled;this.setState({presetFilterEnabled:e}),this.updateVisibleTasks(null,e)}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;e.project.current_code_version!==this.props.project.current_code_version&&this.updateVisibleTasks(),e.highlightedTask!==this.props.highlightedTask&&null!==this.props.highlightedTask&&this.setState({presetFilterEnabled:!1,activeTab:1},function(){return n.updateVisibleTasks()})}},{key:"openPresetViewer",value:function(){this.props.closeViewer(),this.presetViewerRef.current.open()}},{key:"togglePresetSortingMode",value:function(){this.setState({presetSortingMode:!this.state.presetSortingMode})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"project",style:this.props.visible?{}:{display:"none"}},s.a.createElement("div",{className:"tabs"},s.a.createElement("div",{className:0===this.state.activeTab?"tab-active":"",onClick:function(){return e.showTab(0)}},"Presets"),s.a.createElement("div",{className:1===this.state.activeTab?"tab-active":"",onClick:function(){return e.showTab(1)}},"Tasks")),s.a.createElement("div",{className:"sorting"},0===this.state.activeTab&&s.a.createElement("div",null,s.a.createElement("span",{onClick:this.togglePresetSortingMode,className:"fas fa-sort"})),1===this.state.activeTab&&s.a.createElement("div",null,s.a.createElement("label",null,"Sorting:"),s.a.createElement("select",{value:this.state.sorting[1],onChange:this.onChangeSorting},s.a.createElement("option",{value:"0"},"Finished"),s.a.createElement("option",{value:"1"},"Name"),s.a.createElement("option",{value:"2"},"Created"),s.a.createElement("option",{value:"3"},"Iterations")),s.a.createElement("span",{onClick:this.switchSortingDirection,className:this.state.sortingDescending[this.state.activeTab]?"fa fa-sort-amount-down":"fa fa-sort-amount-up"}),s.a.createElement("span",{className:"fas fa-sliders-h",onClick:this.openPresetViewer}))),s.a.createElement(re,{active:0===this.state.activeTab,presetsByGroup:this.state.presetsByGroup,sorting:this.state.sorting,project:this.props.project,sortingDescending:this.state.sortingDescending,presetSortingMode:this.state.presetSortingMode,presets:this.state.presets,numberOfTasksPerChoice:this.state.numberOfTasksPerChoice}),s.a.createElement(le,{active:1===this.state.activeTab,presets:this.state.presets,project:this.props.project,tasks:this.state.tasks,selectedTasks:this.state.selectedTasks,selectedChoices:this.state.selectedChoices,presetFilterEnabled:this.state.presetFilterEnabled,sorting:this.state.sorting,sortingDescending:this.state.sortingDescending,onSelectionChange:this.onSelectionChange,showTask:this.props.showTask,presetsByGroup:this.state.presetsByGroup,highlightedTask:this.props.highlightedTask,filterLikeTask:this.filterLikeTask,devices:this.props.devices}),s.a.createElement(ce,{ref:this.presetViewerRef,numberOfTasksPerChoice:this.state.numberOfTasksPerChoice,presetsByGroup:this.state.presetsByGroup,selectedChoices:this.state.selectedChoices,onSelectionChange:this.onSelectionChange,togglePresetFilter:this.togglePresetFilter,presetFilterEnabled:this.state.presetFilterEnabled}))}}]),t}(s.a.Component),he=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={open:!1,choices:{},newName:""},a.open=a.open.bind(Object(h.a)(a)),a.close=a.close.bind(Object(h.a)(a)),a.onNewNameChange=a.onNewNameChange.bind(Object(h.a)(a)),a.addCodeVersion=a.addCodeVersion.bind(Object(h.a)(a)),a.selectCodeVersion=a.selectCodeVersion.bind(Object(h.a)(a)),a.selectCodeVersion=a.selectCodeVersion.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"open",value:function(){this.setState({open:!0})}},{key:"close",value:function(){this.setState({open:!1})}},{key:"onNewNameChange",value:function(e){this.setState({newName:e.target.value})}},{key:"addCodeVersion",value:function(){fetch("/add_code_version/"+this.props.project_name+"/"+this.state.newName).then(function(e){return e.json()}).then(function(e){},function(e){}),this.setState({newName:""})}},{key:"selectCodeVersion",value:function(e){fetch("/select_code_version/"+this.props.project_name+"/"+e).then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"findCodeVersionInTree",value:function(e,t){if(e.uuid===t)return e;var a=!0,n=!1,s=void 0;try{for(var i,r=e.children[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value,c=this.findCodeVersionInTree(o,t);if(null!==c)return c}}catch(l){n=!0,s=l}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}return null}},{key:"selectBranch",value:function(e,t){var a=Object.assign({},this.state.choices);a[e.uuid]=t,this.setState({choices:a})}},{key:"render",value:function(){var e=this;if(!this.state.open||null===this.props.codeVersionTree)return"";var t=function(){for(var t=e.findCodeVersionInTree(e.props.codeVersionTree,e.props.currentCodeVersion),a={};null!==t.base;)t.base.children.length>0&&(a[t.base.uuid]=t.base.children.findIndex(function(e){return e===t})),t=t.base;for(var n=[{version:e.props.codeVersionTree,child_index:0,total_children:1}],i=e.props.codeVersionTree;i.children.length>0;){var r=0;i.uuid in e.state.choices?r=e.state.choices[i.uuid]:i.uuid in a&&(r=a[i.uuid]),n.push({version:i.children[r],child_index:r,total_children:i.children.length}),i=i.children[r]}return{v:s.a.createElement("div",{className:"code-version-viewer slide-editor editor"},s.a.createElement("div",{className:"header"},"Code versions",s.a.createElement("i",{class:"fas fa-times",onClick:e.close})),s.a.createElement("div",{className:"code-versions"},n.map(function(t,a){return s.a.createElement("div",null,s.a.createElement("div",{className:"code-version-row"},t.child_index>0?s.a.createElement("div",{className:"code-version-branch-arrow",onClick:function(){return e.selectBranch(t.version.base,t.child_index-1)}},s.a.createElement("i",{className:"fas fa-chevron-left"})):s.a.createElement("div",{className:"code-version-branch-arrow"}),s.a.createElement("div",{className:e.props.currentCodeVersion===t.version.uuid?"code-version current-code-version":"code-version",onClick:function(){return e.selectCodeVersion(t.version.uuid)}},s.a.createElement("div",{className:"name"},t.version.name),s.a.createElement("div",{className:"time"},t.version.time.toShortStr())),t.child_index<t.total_children-1?s.a.createElement("div",{className:"code-version-branch-arrow",onClick:function(){return e.selectBranch(t.version.base,t.child_index+1)}},s.a.createElement("i",{className:"fas fa-chevron-right"})):s.a.createElement("div",{className:"code-version-branch-arrow"})),a<n.length-1&&s.a.createElement("div",{className:"arrow"},s.a.createElement("i",{className:"fas fa-long-arrow-alt-down"})))})),s.a.createElement("div",{style:{flex:"1 1 0"}}),s.a.createElement("div",{className:"header"},"Add code version"),s.a.createElement("div",{className:"field"},s.a.createElement("label",null,"Name:"),s.a.createElement("input",{value:e.state.newName,onChange:e.onNewNameChange})),s.a.createElement("div",{className:"buttons"},s.a.createElement("div",{onClick:e.addCodeVersion},"Add")))}}();return"object"===typeof t?t.v:void 0}}]),t}(s.a.Component),de=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={projects:[],codeVersionTrees:{},currentProject:0,highlightedTask:null},a.gotoTB=a.gotoTB.bind(Object(h.a)(a)),a.addVersion=a.addVersion.bind(Object(h.a)(a)),a.updateProjects=a.updateProjects.bind(Object(h.a)(a)),a.addCodeVersions=a.addCodeVersions.bind(Object(h.a)(a)),a.openTaskViewer=a.openTaskViewer.bind(Object(h.a)(a)),a.openCodeVersionViewer=a.openCodeVersionViewer.bind(Object(h.a)(a)),a.closeViewer=a.closeViewer.bind(Object(h.a)(a)),a.promptRefs=s.a.createRef(),a.codeVersionViewerRef=s.a.createRef(),a.taskViewerRef=s.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){for(var e in this.props.repository.onChange("projects",this.updateProjects),this.props.repository.onAdd("codeVersions",this.addCodeVersions),this.updateProjects(this.props.repository.projects),this.props.repository.codeVersions)this.addCodeVersions(this.props.repository.codeVersions[e])}},{key:"componentWillUnmount",value:function(){this.props.repository.removeOnChange("projects",this.updateProjects),this.props.repository.removeOnAdd("codeVersions",this.addCodeVersions)}},{key:"updateProjects",value:function(e){this.setState({projects:Object.values(e)})}},{key:"addCodeVersions",value:function(e){var t={uuid:e.uuid,name:e.name,base:e.base,time:e.time,children:[]},a=Object.assign({},this.state.codeVersionTrees),n=e.project_name;n in a?(this.insertCodeVersionNode(a[n],t),this.setState({codeVersionTrees:a})):(a[n]=t,this.setState({codeVersionTrees:a}))}},{key:"insertCodeVersionNode",value:function(e,t){if(e.uuid===t.base)e.children.push(t),t.base=e;else{var a=!0,n=!1,s=void 0;try{for(var i,r=e.children[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;this.insertCodeVersionNode(o,t)}}catch(c){n=!0,s=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}}},{key:"updateCodeVersionNode",value:function(e,t){if(e.uuid===t.uuid)e.name=t.name,e.time=t.time;else{var a=!0,n=!1,s=void 0;try{for(var i,r=e.children[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;this.updateCodeVersionNode(o,t)}}catch(c){n=!0,s=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}}},{key:"gotoTB",value:function(){-1===this.state.projects[this.state.currentProject].tensorboard_port?fetch("/tensorboard/"+this.state.projects[this.state.currentProject].name).then(function(e){return e.json()}).then(function(e){-1!==e&&window.open("//"+window.location.hostname+":"+e,"_blank")},function(e){}):window.open("//"+window.location.hostname+":"+this.state.projects[this.state.currentProject].tensorboard_port,"_blank")}},{key:"changeProject",value:function(e){var t=this.state.currentProject;t+=e,t=Math.min(this.state.projects.length-1,Math.max(0,t)),this.setState({currentProject:t})}},{key:"addVersion",value:function(){this.promptRefs.current.openDialog()}},{key:"closeViewer",value:function(){this.codeVersionViewerRef.current.close(),this.taskViewerRef.current.close()}},{key:"openTaskViewer",value:function(e){this.closeViewer(),this.taskViewerRef.current.open(e)}},{key:"openCodeVersionViewer",value:function(){this.closeViewer(),this.codeVersionViewerRef.current.open()}},{key:"highlightTask",value:function(e){var t=this,a=this.state.projects.findIndex(function(t){return t.name===e.project_name});-1!==a&&(this.setState({currentProject:a,highlightedTask:e.uuid}),setTimeout(function(){t.setState({highlightedTask:null})},1500))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"project-manager"},s.a.createElement("div",{id:"projects-toolbar"},this.state.projects.length>0&&s.a.createElement("div",{id:"project-selector"},s.a.createElement("span",{onClick:function(){return e.changeProject(-1)},className:this.state.currentProject>0?"active":""},s.a.createElement("i",{className:"fas fa-caret-left"})),s.a.createElement("span",null,this.state.projects[this.state.currentProject].name),s.a.createElement("span",{onClick:function(){return e.changeProject(1)},className:this.state.currentProject<this.state.projects.length-1?"active":""},s.a.createElement("i",{className:"fas fa-caret-right"}))),this.state.projects.length>0&&this.state.projects[this.state.currentProject].current_code_version in this.props.repository.codeVersions&&s.a.createElement("span",{id:"project-toolbar"},s.a.createElement("div",{id:"code-version",title:"Add new code version",onClick:this.openCodeVersionViewer},this.props.repository.codeVersions[this.state.projects[this.state.currentProject].current_code_version].name),s.a.createElement("div",{id:"tb-link",onClick:this.gotoTB,title:"Start and open tensorboard"},"TB"))),s.a.createElement("div",{id:"projects"},this.state.projects.map(function(t,a){return s.a.createElement(ue,{key:t.name,project:t,repository:e.props.repository,visible:a===e.state.currentProject,showTask:e.openTaskViewer,closeViewer:e.closeViewer,highlightedTask:a===e.state.currentProject?e.state.highlightedTask:null,devices:e.props.devices})})),this.state.projects.length>0&&this.state.projects[this.state.currentProject].name in this.state.codeVersionTrees&&s.a.createElement(he,{ref:this.codeVersionViewerRef,codeVersionTree:this.state.codeVersionTrees[this.state.projects[this.state.currentProject].name],currentCodeVersion:this.state.projects[this.state.currentProject].current_code_version,project_name:this.state.projects[this.state.currentProject].name}),s.a.createElement(oe,{ref:this.taskViewerRef,repository:this.props.repository,presets:Object.values(this.props.repository.presets),codeVersions:this.props.repository.codeVersions}))}}]),t}(s.a.Component),pe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={state:"state"in e?e.state:0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={};return 0===this.state.state?e={marginLeft:-400}:1===this.state.state?e={marginLeft:0}:2===this.state.state&&(e={marginLeft:0,marginTop:-26}),s.a.createElement("div",{className:"flash-message level-"+this.props.flashMessage.level,style:e,title:this.props.flashMessage.message},this.props.flashMessage.short)}}]),t}(s.a.Component),me=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={flashMessages:[]},a.flashMessagesRefs=[],a.nextId=0;var n=Object(h.a)(a);return a.props.evtSource.addEventListener("FLASH_MESSAGE",function(e){var t=n.state.flashMessages.slice(),a=JSON.parse(e.data);a.id=n.nextId++,t.push(a),n.flashMessagesRefs.push(s.a.createRef());var i=n.flashMessagesRefs[n.flashMessagesRefs.length-1];setTimeout(function(){return n.nextState(i)},100),n.setState({flashMessages:t})}),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"nextState",value:function(e){var t=this;if(0===e.current.state.state)e.current.setState({state:1}),setTimeout(function(){return t.nextState(e)},1e4);else if(1===e.current.state.state)e.current.setState({state:2}),setTimeout(function(){return t.nextState(e)},1e3);else if(2===e.current.state.state){var a=this.state.flashMessages.slice(),n=this.flashMessagesRefs.findIndex(function(t){return t===e});a.splice(n,1),this.flashMessagesRefs.splice(n,1),this.setState({flashMessages:a})}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"flash-messages"},this.state.flashMessages.map(function(t,a){return s.a.createElement(pe,{key:t.id,flashMessage:t,ref:e.flashMessagesRefs[a]})}),this.props.noConnection&&s.a.createElement(pe,{key:"-1",flashMessage:{short:"No connection to server",level:"40"},state:"1"}))}}]),t}(s.a.Component),fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).openGlobalLog=a.openGlobalLog.bind(Object(h.a)(a)),a.pauseAll=a.pauseAll.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"openGlobalLog",value:function(){window.open("/log","_blank")}},{key:"pauseAll",value:function(){fetch("/pause_all/").then(function(e){return e.json()}).then(function(e){},function(e){})}},{key:"render",value:function(){return s.a.createElement("div",{id:"controlbar"},s.a.createElement("div",{className:"container"},s.a.createElement("h1",{id:"title"},"TaskPlan"),s.a.createElement("div",{className:"action",onClick:this.pauseAll,title:"Pause all running tasks"},s.a.createElement("i",{className:"fa fa-pause"})),s.a.createElement("div",{className:"action",onClick:this.openGlobalLog,title:"Open the global log"},s.a.createElement("i",{className:"far fa-file-alt"}))))}}]),t}(s.a.Component),ve=a(102),ke=a.n(ve),ge=function(){function e(t){var a=this;Object(o.a)(this,e),this.evtSource=t,this.presets={},this.projects={},this.choices={},this.tasks={},this.codeVersions={},this.onChangeListeners={presets:[],projects:[],choices:[],tasks:[],codeVersions:[]},this.onAddListeners={presets:[],projects:[],choices:[],tasks:[],codeVersions:[]},this.onRemoveListeners={presets:[],projects:[],choices:[],tasks:[],codeVersions:[]},this.evtSource.addEventListener("PROJECT_CHANGED",function(e){var t=JSON.parse(e.data);a.updateEntity(a.projects,t,"projects","name")}),this.evtSource.addEventListener("CODE_VERSION_CHANGED",function(e){var t=JSON.parse(e.data);t.time=new Date(1e3*t.time),a.updateEntity(a.codeVersions,t,"codeVersions")}),this.evtSource.addEventListener("PRESET_CHANGED",function(e){var t=JSON.parse(e.data);t.uuid in a.presets?t.choices=a.presets[t.uuid].choices:t.choices=[],t.deprecated_choice in a.choices&&(t.deprecated_choice=a.choices[t.deprecated_choice]),t.default_choice in a.choices&&(t.default_choice=a.choices[t.default_choice]),a.updateEntity(a.presets,t,"presets")}),this.evtSource.addEventListener("CHOICE_CHANGED",function(e){var t=JSON.parse(e.data);t.creation_time=new Date(1e3*t.creation_time),a.updateEntity(a.choices,t,"choices");var n=a.presets[t.preset],s=n.choices.findIndex(function(e){return e.uuid===t.uuid});s>=0?n.choices[s]=t:n.choices.push(t),a.updateEntity(a.presets,n,"presets"),void 0!==(n=Object.values(a.presets).find(function(e){return e.deprecated_choice===t.uuid}))&&(n.deprecated_choice=t,a.updateEntity(a.presets,n,"presets")),void 0!==(n=Object.values(a.presets).find(function(e){return e.default_choice===t.uuid}))&&(n.default_choice=t,a.updateEntity(a.presets,n,"presets"))}),this.evtSource.addEventListener("TASK_CHANGED",function(e){var t=JSON.parse(e.data);t.creation_time=new Date(1e3*t.creation_time),t.saved_time=new Date(1e3*t.saved_time),t.choices=t.choices.map(function(e){return[a.choices[e[0]]].concat(e.slice(1))});var n=!0,s=!1,i=void 0;try{for(var r,o=t.checkpoints[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value;c.time=new Date(1e3*c.time)}}catch(l){s=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}t.state===p.RUNNING&&(t.uuid in a.tasks&&(t.finished_iterations!==a.tasks[t.uuid].finished_iterations?(t.mean_iteration_time=(t.iteration_update_time-(0===a.tasks[t.uuid].iteration_update_time?t.start_time:a.tasks[t.uuid].iteration_update_time))/(t.finished_iterations-a.tasks[t.uuid].finished_iterations),t.total_time=parseInt(t.iteration_update_time-t.start_time+t.mean_iteration_time*(t.total_iterations-t.finished_iterations))):(t.mean_iteration_time=a.tasks[t.uuid].mean_iteration_time,t.total_time=a.tasks[t.uuid].total_time)),t.start_time_timestamp=t.start_time,t.start_time=new Date(1e3*t.start_time),B.refreshRunTime(t)),t.uuid in a.tasks&&(t.name=a.tasks[t.uuid].name,t.try=a.tasks[t.uuid].try,t.nameChoices=a.tasks[t.uuid].nameChoices),a.updateEntity(a.tasks,t,"tasks")}),this.evtSource.addEventListener("TASK_REMOVED",function(e){var t=JSON.parse(e.data);a.removeEntity(a.tasks,t,"tasks")}),this.evtSource.addEventListener("CHOICE_REMOVED",function(e){var t=JSON.parse(e.data);a.removeEntity(a.choices,t,"choices");var n=a.presets[t.preset],s=n.choices.findIndex(function(e){return e.uuid===t.uuid});s>=0&&(n.choices.splice(s,1),a.updateEntity(a.presets,n,"presets"))}),this.evtSource.addEventListener("PRESET_REMOVED",function(e){var t=JSON.parse(e.data);a.removeEntity(a.presets,t,"presets")}),this.standardView=new q(!0);var n=function(){for(var e=0,t=Object.keys(a.tasks);e<t.length;e++){var n=t[e];if(a.tasks[n].is_test)a.tasks[n].nameChoices=[],a.tasks[n].try=0;else{var s=a.standardView.taskByUuid[n];a.tasks[n].nameChoices=a.standardView.getNodeChoicePath(s,a.tasks[n]),a.tasks[n].try=a.standardView.keyInDict(s.children,n)}}};this.onAdd("tasks",function(e){e.is_test||a.standardView.addTask(e),n()}),this.onRemove("tasks",function(e){a.standardView.removeTask(e),n()}),this.onChange("presets",function(e){a.standardView.updatePresets(Object.values(e)),n()}),this.onChange("tasks",function(e){a.standardView.updateTasks(e)})}return Object(c.a)(e,[{key:"updateEntity",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"uuid",s=!(t[n]in e);e[t[n]]=t,s&&this.throwOnAddEvent(t,a),this.throwOnChangeEvent(e,a)}},{key:"removeEntity",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"uuid",s=e[t[n]];delete e[t[n]],this.throwOnRemoveEvent(s,a),this.throwOnChangeEvent(e,a)}},{key:"throwOnChangeEvent",value:function(e,t){var a=Object.assign({},e),n=!0,s=!1,i=void 0;try{for(var r,o=this.onChangeListeners[t][Symbol.iterator]();!(n=(r=o.next()).done);n=!0){(0,r.value)(a)}}catch(c){s=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}}},{key:"throwOnAddEvent",value:function(e,t){var a=!0,n=!1,s=void 0;try{for(var i,r=this.onAddListeners[t][Symbol.iterator]();!(a=(i=r.next()).done);a=!0){(0,i.value)(e)}}catch(o){n=!0,s=o}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}},{key:"throwOnRemoveEvent",value:function(e,t){var a=!0,n=!1,s=void 0;try{for(var i,r=this.onRemoveListeners[t][Symbol.iterator]();!(a=(i=r.next()).done);a=!0){(0,i.value)(e)}}catch(o){n=!0,s=o}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}},{key:"onChange",value:function(e,t){this.onChangeListeners[e].push(t)}},{key:"removeOnChange",value:function(e,t){var a=this.onChangeListeners[e].findIndex(t);a>=0&&this.onChangeListeners[e].splice(a,1)}},{key:"onAdd",value:function(e,t){this.onAddListeners[e].push(t)}},{key:"removeOnAdd",value:function(e,t){var a=this.onAddListeners[e].findIndex(t);a>=0&&this.onAddListeners[e].splice(a,1)}},{key:"onRemove",value:function(e,t){this.onRemoveListeners[e].push(t)}},{key:"removeOnRemove",value:function(e,t){var a=this.onRemoveListeners[e].findIndex(t);a>=0&&this.onRemoveListeners[e].splice(a,1)}}]),e}(),be=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={noConnection:!0,devices:[]},a.evtSource=new ke.a("/update",{}),a.repository=new ge(a.evtSource),a.projectManagerRef=s.a.createRef(),a.refreshConnectionState=a.refreshConnectionState.bind(Object(h.a)(a)),a.evtSource.onerror=a.refreshConnectionState,a.evtSource.onopen=a.refreshConnectionState,a.state.noConnection=0===a.evtSource.readyState,a.evtSource.addEventListener("SCHEDULER_OPTIONS",function(e){var t=JSON.parse(e.data);a.setState({devices:t.devices})}),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"refreshConnectionState",value:function(){this.setState({noConnection:0===this.evtSource.readyState})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"page"},s.a.createElement(me,{evtSource:this.evtSource,noConnection:this.state.noConnection}),s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm-8"},s.a.createElement(B,{devices:this.state.devices,evtSource:this.evtSource,repository:this.repository,highlightTask:function(t){return e.projectManagerRef.current.highlightTask(t)}})),s.a.createElement("div",{className:"col-sm-4"},s.a.createElement(de,{devices:this.state.devices,ref:this.projectManagerRef,repository:this.repository})))),s.a.createElement(fe,{evtSource:this.evtSource}))}}]),t}(s.a.Component);a(257),a(258),r.a.render(s.a.createElement(be,null),document.getElementById("root"))}},[[103,1,2]]]);
//# sourceMappingURL=main.c1a181f0.chunk.js.map